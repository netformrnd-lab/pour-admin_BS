<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사후관리 Admin | 넷폼 R&D</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #215a65;
            --primary-light: #2d7a87;
            --primary-dark: #184349;
            --accent: #00c471;
            --warning: #ff9500;
            --danger: #ff3b30;
            --bg-main: #f7f8fa;
            --bg-card: #ffffff;
            --text-primary: #191f28;
            --text-secondary: #6b7684;
            --text-tertiary: #8b95a1;
            --border: #e5e8eb;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* ===== 로그인 화면 ===== */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--primary-light) 100%);
        }

        .login-box {
            background: white;
            padding: 48px 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius-lg);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-error {
            background: #fff5f5;
            color: var(--danger);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        .login-btn {
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .login-btn:hover {
            background: var(--primary-dark);
        }

        .login-btn:disabled {
            background: var(--text-tertiary);
            cursor: not-allowed;
        }

        .logout-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: auto;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #e62e24;
        }

        /* 일정 목록 스타일 */
        .schedule-list-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .schedule-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .schedule-item:hover {
            background: var(--border);
        }

        .schedule-date-box {
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .schedule-date-day {
            font-size: 18px;
            font-weight: 700;
            line-height: 1;
        }

        .schedule-date-month {
            font-size: 11px;
            opacity: 0.8;
        }

        .schedule-info {
            flex: 1;
        }

        .schedule-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .schedule-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .schedule-type-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .schedule-type-badge.visit {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .schedule-type-badge.deadline {
            background: #fff3e0;
            color: #ef6c00;
        }

        .schedule-type-badge.reminder {
            background: #e3f2fd;
            color: #1565c0;
        }

        .schedule-actions {
            display: flex;
            gap: 8px;
        }

        .schedule-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .schedule-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .schedule-action-btn.delete:hover {
            background: var(--danger);
        }

        /* 방문 기록 수정/삭제 버튼 */
        .visit-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .visit-action-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .visit-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .visit-action-btn.delete:hover {
            background: var(--danger);
            border-color: var(--danger);
        }

        .empty-schedule {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        /* 일정 캘린더 페이지 */
        .calendar-page {
            padding: 0;
        }

        .calendar-page.hidden {
            display: none;
        }

        /* 담당자 아바타 (일정 목록) */
        .schedule-assignee {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .schedule-assignee-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
        }

        .schedule-assignee-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* 사진 미리보기 */
        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .photo-preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: rgba(0,0,0,0.6);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* 방문 기록 사진 섹션 */
        .visit-photos {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .visit-photos-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .visit-photo-thumb {
            width: 100px;
            height: 100px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            cursor: pointer;
        }

        .visit-photo-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.2s ease;
        }

        .visit-photo-thumb:hover img {
            transform: scale(1.05);
        }

        /* 사진 확대 모달 */
        .photo-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .photo-modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: var(--radius-md);
        }

        .photo-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 24px;
        }

        /* 댓글 섹션 */
        .visit-comments {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .comments-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .comment-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 13px;
            color: var(--text-primary);
        }

        .comment-date {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .comment-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .comment-delete {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 12px;
            padding: 2px 6px;
        }

        .comment-delete:hover {
            color: var(--danger);
        }

        .comment-input-box {
            display: flex;
            gap: 8px;
        }

        .comment-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 13px;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .comment-submit-btn {
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .comment-submit-btn:hover {
            background: var(--primary-hover);
        }

        .empty-comments {
            text-align: center;
            padding: 20px;
            color: var(--text-tertiary);
            font-size: 13px;
        }

        /* 상태 변경 select */
        .status-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            background: var(--bg-card);
            cursor: pointer;
        }

        .status-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 13px;
        }

        /* 담당자 관리 페이지 */
        .users-page {
            padding: 0;
        }

        .users-page.hidden {
            display: none;
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .user-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
            transition: all 0.2s ease;
        }

        .user-card:hover {
            box-shadow: var(--shadow-md);
        }

        .user-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .user-card-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
        }

        .user-card-info h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-card-role {
            display: inline-block;
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
        }

        .user-card-role.admin {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .user-card-role.manager {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .user-card-role.member {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .user-card-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .user-card-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .user-card-detail svg {
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
        }

        .user-card-stats {
            display: flex;
            gap: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .user-card-stat {
            flex: 1;
            text-align: center;
        }

        .user-card-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .user-card-stat-label {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .user-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .user-card-actions button {
            flex: 1;
        }

        /* 대시보드 페이지 */
        .dashboard-page {
            padding: 0;
        }

        .dashboard-page.hidden {
            display: none;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .dashboard-stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .dashboard-stat-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dashboard-stat-icon svg {
            width: 28px;
            height: 28px;
        }

        .dashboard-stat-icon.blue {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .dashboard-stat-icon.green {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .dashboard-stat-icon.orange {
            background: rgba(249, 115, 22, 0.1);
            color: #f97316;
        }

        .dashboard-stat-icon.red {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .dashboard-stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .dashboard-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .dashboard-charts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .dashboard-chart-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
        }

        .dashboard-chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .dashboard-chart {
            height: 250px;
            display: flex;
            align-items: flex-end;
            gap: 12px;
        }

        .chart-bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .chart-bar {
            width: 100%;
            background: var(--primary);
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            transition: height 0.3s ease;
        }

        .chart-bar-label {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .chart-bar-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* 도넛 차트 */
        .donut-chart {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .donut-chart-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .donut-chart-total {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .donut-chart-label {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 20px;
        }

        .chart-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .chart-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* 토스 스타일 도넛 차트 */
        .donut-status-container {
            display: flex;
            align-items: center;
            gap: 20px;
            height: 220px;
        }

        .donut-status-chart {
            flex: 1;
            height: 140px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .donut-status-chart svg {
            width: 140px;
            height: 140px;
            transform: rotate(-90deg);
        }

        .donut-status-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .donut-status-pct {
            font-size: 24px;
            font-weight: 700;
            line-height: 1;
        }

        .donut-status-label {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .donut-status-list {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%;
            justify-content: center;
        }

        .donut-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            flex: 1;
        }

        .donut-status-name {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .donut-status-count {
            font-size: 18px;
            font-weight: 700;
        }

        .dashboard-chart {
            height: 250px;
            display: flex;
            align-items: flex-end;
            gap: 12px;
        }

        .chart-bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .chart-bar {
            width: 100%;
            background: var(--primary);
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            transition: height 0.3s ease;
        }

        .chart-bar-label {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .chart-bar-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .dashboard-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .dashboard-activity {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
        }

        .dashboard-activity-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dashboard-activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
        }

        .dashboard-activity-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .dashboard-activity-info {
            flex: 1;
        }

        .dashboard-activity-title {
            font-weight: 500;
            color: var(--text-primary);
        }

        .dashboard-activity-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .dashboard-activity-time {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        @media (max-width: 1200px) {
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            .dashboard-charts {
                grid-template-columns: 1fr;
            }
        }

        /* ===== Layout ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ===== Sidebar ===== */
        .sidebar {
            width: 260px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 12px 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .logo-sub {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .nav-menu {
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 15px;
        }

        .nav-item:hover {
            background: var(--bg-main);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav-divider {
            height: 1px;
            background: var(--border);
            margin: 16px 12px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            margin-top: auto;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }

        .user-role {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* ===== Main Content ===== */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 24px 32px;
            min-height: 100vh;
        }

        /* ===== Header ===== */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-main);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        /* ===== Search & Filter Bar ===== */
        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 280px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 14px 16px 14px 48px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: inherit;
            background: var(--bg-card);
            transition: all 0.2s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 90, 101, 0.1);
        }

        .search-box input::placeholder {
            color: var(--text-tertiary);
        }

        .search-box svg {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--text-tertiary);
        }

        .filter-select {
            padding: 14px 40px 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: inherit;
            background: var(--bg-card);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7684'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
            min-width: 140px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ===== Stats Cards ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px 24px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 8px;
        }

        .stat-change.positive {
            color: var(--accent);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* ===== Complex List (Apartments) ===== */
        .complex-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
        }

        .complex-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 20px;
            cursor: pointer;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }

        .complex-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .complex-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .complex-card:hover::before {
            opacity: 1;
        }

        .complex-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .complex-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .complex-address {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .status-normal {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-tracking {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-revisit {
            background: #ffebee;
            color: #c62828;
        }

        .complex-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .info-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
        }

        /* ===== Construction Types Tags ===== */
        .construction-types {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .construction-tag {
            display: inline-block;
            padding: 4px 10px;
            background: #e3f2fd;
            color: var(--primary);
            font-size: 11px;
            font-weight: 600;
            border-radius: 12px;
        }

        .detail-construction-types {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .detail-construction-tag {
            display: inline-block;
            padding: 6px 14px;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: var(--primary);
            font-size: 13px;
            font-weight: 600;
            border-radius: 16px;
        }

        /* ===== Visit Checklist Styles ===== */
        .scope-select-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .scope-checkbox {
            display: none;
        }

        .scope-label {
            display: inline-block;
            padding: 10px 18px;
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .scope-label:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .scope-checkbox:checked + .scope-label {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .checklist-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }

        .checklist-container.active {
            display: block;
        }

        .checklist-scope-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .checklist-category {
            margin-bottom: 20px;
        }

        .checklist-category:last-child {
            margin-bottom: 0;
        }

        .checklist-category-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checklist-category-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--primary);
            border-radius: 2px;
        }

        .checklist-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .checklist-table th {
            padding: 10px 12px;
            background: var(--primary);
            color: white;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .checklist-table th:first-child {
            text-align: left;
            width: 35%;
        }

        .checklist-table th:not(:first-child):not(:last-child) {
            width: 13%;
        }

        .checklist-table th:last-child {
            width: 26%;
        }

        .checklist-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            text-align: center;
        }

        .checklist-table td:first-child {
            text-align: left;
            font-weight: 500;
            color: var(--text-primary);
        }

        .checklist-table tr:last-child td {
            border-bottom: none;
        }

        .checklist-table tr:hover {
            background: var(--bg-main);
        }

        .checklist-radio-group {
            display: flex;
            justify-content: center;
        }

        .checklist-radio {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checklist-note-input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            font-family: inherit;
        }

        .checklist-note-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .checklist-divider {
            height: 1px;
            background: var(--border);
            margin: 16px 0;
        }

        /* ===== Detail Page ===== */
        .detail-page {
            display: none;
        }

        .detail-page.active {
            display: block;
        }

        .main-page.hidden {
            display: none;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            padding: 8px 0;
            transition: color 0.2s ease;
        }

        .back-button:hover {
            color: var(--primary);
        }

        .back-button svg {
            width: 20px;
            height: 20px;
        }

        /* 상단 바 (뒤로가기 + 시크릿 모드) */
        .detail-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        /* 시크릿 모드 버튼 */
        .secret-mode-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .secret-mode-btn:hover {
            background: var(--bg-card);
            border-color: var(--primary);
            color: var(--primary);
        }

        .secret-mode-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .secret-mode-btn svg {
            width: 16px;
            height: 16px;
        }

        /* 시크릿 모드 활성화 시 댓글 숨김 */
        .secret-mode .visit-comments,
        .secret-mode .visit-action-btn:last-child {
            display: none !important;
        }

        /* ===== Detail Header ===== */
        .detail-header {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 28px;
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .detail-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .detail-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .detail-address {
            font-size: 15px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .detail-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .meta-label {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .meta-value {
            font-size: 15px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .meta-value.editable {
            padding: 8px 12px;
            background: var(--bg-main);
            border-radius: var(--radius-sm);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .meta-value.editable:hover {
            border-color: var(--border);
        }

        /* ===== Tab Navigation ===== */
        .tab-nav {
            display: flex;
            gap: 4px;
            background: var(--bg-card);
            padding: 6px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            margin-bottom: 24px;
            overflow-x: auto;
        }

        .tab-item {
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .tab-item:hover {
            background: var(--bg-main);
            color: var(--text-primary);
        }

        .tab-item.active {
            background: var(--primary);
            color: white;
        }

        /* ===== Tab Content ===== */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== Visit Timeline ===== */
        .timeline {
            position: relative;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timeline-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .visit-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
            margin-bottom: 16px;
            position: relative;
            transition: all 0.2s ease;
        }

        .visit-card:hover {
            box-shadow: var(--shadow-md);
        }

        .visit-card::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 32px;
            width: 12px;
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
            border: 3px solid var(--bg-main);
        }

        .visit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .visit-date {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .visit-purpose {
            display: inline-block;
            padding: 6px 12px;
            background: var(--bg-main);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
        }

        .visit-body {
            margin-bottom: 16px;
        }

        .visit-row {
            display: flex;
            gap: 24px;
            margin-bottom: 12px;
        }

        .visit-field {
            flex: 1;
        }

        .visit-label {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .visit-value {
            font-size: 14px;
            color: var(--text-primary);
        }

        .visit-memo {
            padding: 16px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ===== Photo Grid ===== */
        .photo-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: var(--radius-md);
            background: var(--bg-main);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-badge {
            position: absolute;
            bottom: 8px;
            left: 8px;
            padding: 4px 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 10px;
            font-weight: 600;
            border-radius: 4px;
        }

        /* ===== AI Diagnosis ===== */
        .ai-diagnosis {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-top: 16px;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .ai-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .ai-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .ai-result {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .ai-item {
            background: white;
            padding: 12px;
            border-radius: var(--radius-sm);
        }

        .ai-item-label {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .ai-item-value {
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 600;
        }

        /* ===== Next Visit ===== */
        .next-visit {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--primary);
            border-radius: var(--radius-md);
            color: white;
            margin-top: 16px;
        }

        .next-visit svg {
            width: 20px;
            height: 20px;
        }

        .next-visit-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .next-visit-date {
            font-size: 15px;
            font-weight: 700;
        }

        /* ===== Calendar ===== */
        .calendar-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-nav button {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: var(--bg-card);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .calendar-nav button:hover {
            background: var(--bg-main);
            border-color: var(--primary);
        }

        .calendar-month {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 8px 4px;
            background: var(--bg-main);
        }

        .calendar-day-header:first-child {
            color: #ff6b6b;
        }

        .calendar-day-header:last-child {
            color: #3182f6;
        }

        .calendar-day {
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: flex-start;
            padding: 4px;
            background: var(--bg-card);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-main);
        }

        .calendar-day.other-month {
            background: var(--bg-main);
            opacity: 0.5;
        }

        .calendar-day-number {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 4px;
            padding: 2px 4px;
        }

        .calendar-day.today .calendar-day-number {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:first-child .calendar-day-number,
        .calendar-day:nth-child(7n+1) .calendar-day-number {
            color: #ff6b6b;
        }

        .calendar-day:nth-child(7n) .calendar-day-number {
            color: #3182f6;
        }

        .calendar-day.today .calendar-day-number {
            color: white;
        }

        /* 캘린더 일정 텍스트 */
        .calendar-event-item {
            font-size: 10px;
            padding: 2px 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        .calendar-event-item.visit {
            background: rgba(49, 130, 246, 0.15);
            color: #3182f6;
        }

        .calendar-event-item.deadline {
            background: rgba(0, 196, 113, 0.15);
            color: #00c471;
        }

        .calendar-event-item.reminder {
            background: rgba(33, 90, 101, 0.15);
            color: #215a65;
        }

        .calendar-event-more {
            font-size: 10px;
            color: var(--text-tertiary);
            padding: 2px 4px;
        }

        /* 일정 목록 D-Day 스타일 */
        .schedule-dday {
            min-width: 50px;
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 700;
            text-align: center;
        }

        .schedule-dday.today {
            background: var(--danger);
            color: white;
        }

        .schedule-dday.upcoming {
            background: #3182f6;
            color: white;
        }

        .schedule-dday.past {
            background: var(--text-tertiary);
            color: white;
        }

        /* 메인 페이지 캘린더 컨테이너 */
        .main-calendar-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .main-calendar-section .calendar-header {
            margin-bottom: 16px;
        }

        .main-calendar-section .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        /* ===== Manager Section ===== */ */
        .manager-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            padding: 24px;
        }

        .manager-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
        }

        .manager-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .manager-info {
            flex: 1;
        }

        .manager-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .manager-role {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .manager-contact {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .manager-action {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-card);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .manager-action:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* ===== Modal ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--border);
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 90, 101, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .form-section-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-section-optional {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-tertiary);
        }

        .form-divider {
            height: 1px;
            background: var(--border);
            margin: 24px 0;
        }

        .required {
            color: var(--danger);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-label {
            font-size: 14px;
            color: var(--text-primary);
            user-select: none;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid var(--border);
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: var(--bg-main);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: var(--text-tertiary);
        }

        .empty-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* ===== Mobile Menu Toggle ===== */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 50%;
            border: none;
            color: white;
            cursor: pointer;
            z-index: 101;
            box-shadow: var(--shadow-lg);
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-toggle svg {
            width: 24px;
            height: 24px;
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .complex-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .header-actions {
                width: 100%;
            }

            .header-actions .btn {
                flex: 1;
                justify-content: center;
            }

            .filter-bar {
                flex-direction: column;
            }

            .search-box {
                min-width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            .complex-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .detail-meta {
                grid-template-columns: repeat(2, 1fr);
            }

            .tab-nav {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .visit-row {
                flex-direction: column;
                gap: 12px;
            }

            .ai-result {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal {
                max-height: 100vh;
                border-radius: var(--radius-lg);
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 16px;
            }

            .page-title {
                font-size: 24px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 28px;
            }

            .complex-card {
                padding: 16px;
            }

            .detail-header {
                padding: 20px;
            }

            .detail-title {
                font-size: 22px;
            }

            .visit-card {
                padding: 16px;
            }

            .photo-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .calendar-container {
                padding: 16px;
            }
        }

        /* ===== Utility Classes ===== */
        .timeline-wrapper {
            padding-left: 40px;
            border-left: 2px solid var(--border);
            margin-left: 20px;
        }

        /* ===== Notification Bell ===== */
        .notification-bell {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--bg-main);
            border: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .notification-bell:hover {
            background: var(--border);
        }

        .notification-bell svg {
            width: 22px;
            height: 22px;
            color: var(--text-secondary);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            min-width: 20px;
            height: 20px;
            background: var(--danger);
            color: white;
            font-size: 11px;
            font-weight: 700;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
        }

        /* ===== Notification Panel ===== */
        .notification-panel {
            position: fixed;
            top: 0;
            right: -420px;
            width: 400px;
            height: 100vh;
            background: var(--bg-card);
            box-shadow: -4px 0 24px rgba(0,0,0,0.15);
            z-index: 200;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .notification-panel.open {
            right: 0;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .notification-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .notification-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-tabs {
            display: flex;
            padding: 0 24px;
            border-bottom: 1px solid var(--border);
        }

        .notification-tab {
            padding: 14px 16px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-tertiary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.2s ease;
        }

        .notification-tab:hover {
            color: var(--text-primary);
        }

        .notification-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .notification-tab .tab-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: var(--bg-main);
            border-radius: 9px;
            font-size: 11px;
            margin-left: 6px;
        }

        .notification-tab.active .tab-count {
            background: var(--primary);
            color: white;
        }

        .notification-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .notification-item {
            display: flex;
            gap: 14px;
            padding: 16px;
            background: var(--bg-main);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .notification-item:hover {
            background: var(--border);
        }

        .notification-item.unread::before {
            content: '';
            position: absolute;
            left: 6px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
        }

        .notification-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-icon.warning {
            background: #fff3e0;
            color: var(--warning);
        }

        .notification-icon.danger {
            background: #ffebee;
            color: var(--danger);
        }

        .notification-icon.info {
            background: #e3f2fd;
            color: var(--primary);
        }

        .notification-icon.success {
            background: #e8f5e9;
            color: var(--accent);
        }

        .notification-icon svg {
            width: 22px;
            height: 22px;
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-item-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .notification-mention {
            display: inline-block;
            background: #e3f2fd;
            color: var(--primary);
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 6px;
        }

        .notification-item-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .notification-item-time {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        .notification-item-action {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .notif-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .notif-btn-primary {
            background: var(--primary);
            color: white;
        }

        .notif-btn-primary:hover {
            background: var(--primary-light);
        }

        .notif-btn-secondary {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .notification-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .notification-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .notification-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* ===== Calendar Event Popup ===== */
        .calendar-day {
            position: relative;
        }

        .calendar-day.has-event {
            cursor: pointer;
        }

        .calendar-event-popup {
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            z-index: 50;
            padding: 16px;
            display: none;
        }

        .calendar-day.has-event:hover .calendar-event-popup {
            display: block;
        }

        .calendar-event-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid var(--bg-card);
        }

        .event-popup-date {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .event-popup-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .event-popup-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .event-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            margin-top: 6px;
            flex-shrink: 0;
        }

        .event-dot.visit {
            background: var(--accent);
        }

        .event-dot.deadline {
            background: var(--warning);
        }

        .event-dot.urgent {
            background: var(--danger);
        }

        .event-popup-content {
            flex: 1;
        }

        .event-popup-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .event-popup-sub {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        @media (max-width: 768px) {
            .notification-panel {
                width: 100%;
                right: -100%;
            }

            .calendar-event-popup {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                transform: none;
                width: 100%;
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                max-height: 50vh;
                overflow-y: auto;
            }

            .calendar-event-popup::before {
                display: none;
            }
        }

        /* ===== Animations ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .complex-card, .visit-card, .stat-card {
            animation: fadeIn 0.3s ease;
        }

        /* ===== Scrollbar ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">
                <div class="login-logo-icon">NF</div>
                <h1 class="login-title">사후관리 시스템</h1>
                <p class="login-subtitle">넷폼 R&D 관리자 로그인</p>
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="login-error" id="loginError">
                    아이디 또는 비밀번호가 올바르지 않습니다.
                </div>
                
                <div class="form-group">
                    <label class="form-label">아이디</label>
                    <input type="text" class="form-input" id="loginEmail" placeholder="아이디를 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">비밀번호</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="비밀번호 입력" required>
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">로그인</button>
            </form>
        </div>
    </div>

    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <div class="logo-icon">NF</div>
                <div>
                    <div class="logo-text">넷폼 R&D</div>
                    <div class="logo-sub">사후관리 시스템</div>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="nav-label">메인</div>
                <div class="nav-item active" id="navComplexList" onclick="showMainPage()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    단지 관리
                </div>
                <div class="nav-item" id="navCalendar" onclick="showCalendarPage()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    일정 캘린더
                </div>
                <div class="nav-item" id="navDashboard" onclick="showDashboardPage()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    대시보드
                </div>

                <div class="nav-divider"></div>
                <div class="nav-label">AI 기능</div>
                <div class="nav-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    AI 하자 진단
                </div>
                <div class="nav-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    리포트 생성
                </div>

                <div class="nav-divider"></div>
                <div class="nav-label">설정</div>
                <div class="nav-item" id="navUsers" onclick="showUsersPage()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    담당자 관리
                </div>
                <div class="nav-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    시스템 설정
                </div>
            </nav>

            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">?</div>
                <div class="user-info">
                    <div class="user-name" id="userName">로그인 필요</div>
                    <div class="user-role" id="userRole">-</div>
                </div>
                <button class="logout-btn" onclick="logout()">로그아웃</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Main Page (Complex List) -->
            <div class="main-page" id="mainPage">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">단지 관리</h1>
                        <p class="page-subtitle" id="pageSubtitle">전국 관리 단지 현황을 한눈에 확인하세요</p>
                    </div>
                    <div class="header-actions">
                        <button class="notification-bell" onclick="toggleNotificationPanel()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                            </svg>
                            <span class="notification-badge" id="notificationBadge">5</span>
                        </button>
                        <button class="btn btn-secondary">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            내보내기
                        </button>
                        <button class="btn btn-primary" onclick="openModal('addComplexModal')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            단지 추가
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">전체 단지</div>
                        <div class="stat-value" id="statTotal">6</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">정상 관리</div>
                        <div class="stat-value" id="statNormal">3</div>
                        <div class="stat-change positive" id="statNormalPercent">50%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">추적 필요</div>
                        <div class="stat-value" id="statTracking">2</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">재방문 필요</div>
                        <div class="stat-value" id="statRevisit">1</div>
                        <div class="stat-change negative" id="statRevisitLabel">긴급</div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="search-box">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" placeholder="단지명 또는 지역으로 검색..." id="searchInput" autocomplete="off">
                    </div>
                    <select class="filter-select" id="regionFilter">
                        <option value="">전체 지역</option>
                        <option value="서울">서울</option>
                        <option value="경기">경기</option>
                        <option value="인천">인천</option>
                        <option value="부산">부산</option>
                        <option value="대구">대구</option>
                        <option value="대전">대전</option>
                        <option value="광주">광주</option>
                        <option value="세종">세종</option>
                        <option value="충남">충남</option>
                        <option value="울산">울산</option>
                    </select>
                    <select class="filter-select" id="statusFilter">
                        <option value="">전체 상태</option>
                        <option value="정상">정상</option>
                        <option value="추적 필요">추적 필요</option>
                        <option value="재방문 필요">재방문 필요</option>
                    </select>
                    <select class="filter-select" id="managerFilter">
                        <option value="">전체 담당자</option>
                        <!-- 담당자 목록은 동적으로 로드 -->
                    </select>
                </div>

                <!-- Complex Grid -->
                <div class="complex-grid" id="complexGrid">
                    <!-- Complex cards will be rendered here -->
                </div>
            </div>

            <!-- Calendar Page (전체 일정) -->
            <div class="calendar-page hidden" id="calendarPage">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">일정 캘린더</h1>
                        <p class="page-subtitle" id="calendarPageSubtitle">전체 담당 단지 일정을 확인하세요</p>
                    </div>
                    <div class="header-actions">
                        <select class="filter-select" id="calendarManagerFilter" style="margin-right: 8px;">
                            <option value="">전체 담당자</option>
                            <!-- 담당자 목록은 동적으로 로드 -->
                        </select>
                        <button class="btn btn-secondary" onclick="goToToday()">
                            오늘
                        </button>
                        <button class="btn btn-primary" onclick="openAddScheduleModal(null, true)">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            일정 추가
                        </button>
                    </div>
                </div>

                <div class="main-calendar-section">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button onclick="changeMainMonth(-1)">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>
                            <span class="calendar-month" id="mainCalendarMonth">2026년 1월</span>
                            <button onclick="changeMainMonth(1)">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="mainCalendarGrid">
                        <!-- 전체 캘린더 렌더링 -->
                    </div>
                    <div class="schedule-list-container">
                        <h4 style="margin: 16px 0 12px; font-size: 14px; font-weight: 600;">이번 달 일정</h4>
                        <div id="mainScheduleList">
                            <!-- 일정 목록 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page (대시보드) -->
            <div class="dashboard-page hidden" id="dashboardPage">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">대시보드</h1>
                        <p class="page-subtitle">사후관리 현황을 한눈에 확인하세요</p>
                    </div>
                </div>

                <!-- Dashboard Stats -->
                <div class="dashboard-stats">
                    <div class="dashboard-stat-card">
                        <div class="dashboard-stat-icon blue">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <div class="dashboard-stat-info">
                            <div class="dashboard-stat-value" id="dashTotalComplex">0</div>
                            <div class="dashboard-stat-label">전체 단지</div>
                        </div>
                    </div>
                    <div class="dashboard-stat-card">
                        <div class="dashboard-stat-icon green">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="dashboard-stat-info">
                            <div class="dashboard-stat-value" id="dashNormalComplex">0</div>
                            <div class="dashboard-stat-label">정상 관리</div>
                        </div>
                    </div>
                    <div class="dashboard-stat-card">
                        <div class="dashboard-stat-icon orange">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                        </div>
                        <div class="dashboard-stat-info">
                            <div class="dashboard-stat-value" id="dashTrackingComplex">0</div>
                            <div class="dashboard-stat-label">추적 필요</div>
                        </div>
                    </div>
                    <div class="dashboard-stat-card">
                        <div class="dashboard-stat-icon red">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="dashboard-stat-info">
                            <div class="dashboard-stat-value" id="dashRevisitComplex">0</div>
                            <div class="dashboard-stat-label">재방문 필요</div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Charts -->
                <div class="dashboard-charts">
                    <div class="dashboard-chart-card">
                        <h3 class="dashboard-chart-title">월별 방문 현황</h3>
                        <div class="dashboard-chart" id="visitChart">
                            <!-- Chart rendered here -->
                        </div>
                    </div>
                    <div class="dashboard-chart-card">
                        <h3 class="dashboard-chart-title">단지 상태 분포</h3>
                        <div class="dashboard-chart" id="statusChart">
                            <!-- Chart rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="dashboard-activity">
                    <h3 class="dashboard-section-title">최근 방문 기록</h3>
                    <div class="dashboard-activity-list" id="dashRecentVisits">
                        <!-- Recent visits -->
                    </div>
                </div>
            </div>

            <!-- Users Management Page (담당자 관리) -->
            <div class="users-page hidden" id="usersPage">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">담당자 관리</h1>
                        <p class="page-subtitle">사후관리팀 담당자를 관리합니다</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openAddUserModal()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            담당자 추가
                        </button>
                    </div>
                </div>

                <div class="users-grid" id="usersGrid">
                    <!-- 담당자 카드 렌더링 -->
                </div>
            </div>

            <!-- Detail Page -->
            <div class="detail-page" id="detailPage">
                <div class="detail-top-bar">
                    <div class="back-button" onclick="showMainPage()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        단지 목록으로
                    </div>
                    <button class="secret-mode-btn" id="secretModeBtn" onclick="toggleSecretMode()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span id="secretModeText">고객용 뷰어</span>
                    </button>
                </div>

                <!-- Detail Header -->
                <div class="detail-header" id="detailHeader">
                    <!-- Content will be rendered dynamically -->
                </div>

                <!-- Tab Navigation -->
                <div class="tab-nav">
                    <div class="tab-item active" onclick="switchTab('timeline')">방문 기록</div>
                    <div class="tab-item" onclick="switchTab('calendar')">일정 캘린더</div>
                    <div class="tab-item" onclick="switchTab('manager')">담당자 정보</div>
                </div>

                <!-- Tab Contents -->
                <div class="tab-content active" id="timelineTab">
                    <div class="timeline">
                        <div class="timeline-header">
                            <h3 class="timeline-title">방문 차트 타임라인</h3>
                            <button class="btn btn-primary" onclick="openModal('addVisitModal')">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                방문 기록 추가
                            </button>
                        </div>
                        <div class="timeline-wrapper" id="visitTimeline">
                            <!-- Visit cards will be rendered here -->
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="calendarTab">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button onclick="changeMonth(-1)">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                    </svg>
                                </button>
                                <span class="calendar-month" id="calendarMonth">2025년 1월</span>
                                <button onclick="changeMonth(1)">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="openAddScheduleModal()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                일정 추가
                            </button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar will be rendered here -->
                        </div>
                        <!-- 일정 목록 -->
                        <div class="schedule-list-container" id="scheduleListContainer">
                            <h4 style="margin: 24px 0 16px; font-size: 16px; font-weight: 600;">이번 달 일정</h4>
                            <div id="scheduleList">
                                <!-- 일정 목록 렌더링 -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="managerTab">
                    <div class="manager-section">
                        <h3 class="timeline-title" style="margin-bottom: 20px;">담당자 정보</h3>
                        <div id="managerList">
                            <!-- Manager cards will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>

        <!-- Notification Overlay -->
        <div class="notification-overlay" id="notificationOverlay" onclick="toggleNotificationPanel()"></div>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <h2 class="notification-title">알림 센터</h2>
                <button class="notification-close" onclick="toggleNotificationPanel()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="notification-tabs">
                <div class="notification-tab active" onclick="switchNotificationTab('upcoming', this)">
                    예정 알림<span class="tab-count" id="upcomingCount">3</span>
                </div>
                <div class="notification-tab" onclick="switchNotificationTab('overdue', this)">
                    지난 알림<span class="tab-count" id="overdueCount">2</span>
                </div>
                <div class="notification-tab" onclick="switchNotificationTab('all', this)">
                    전체
                </div>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Notifications will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Add Complex Modal -->
    <div class="modal-overlay" id="addComplexModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">새 단지 추가</h2>
                <button class="modal-close" onclick="closeModal('addComplexModal')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-section-title">기본 정보</div>
                <div class="form-group">
                    <label class="form-label">단지명 <span class="required">*</span></label>
                    <input type="text" class="form-input" placeholder="예: 래미안 센트럴파크">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">지역 <span class="required">*</span></label>
                        <select class="form-input">
                            <option value="">선택하세요</option>
                            <option value="서울">서울</option>
                            <option value="경기">경기</option>
                            <option value="인천">인천</option>
                            <option value="부산">부산</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">담당자 <span class="required">*</span></label>
                        <select class="form-input">
                            <option value="">선택하세요</option>
                            <option value="김철수">김철수</option>
                            <option value="박영희">박영희</option>
                            <option value="이민호">이민호</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">주소</label>
                    <input type="text" class="form-input" placeholder="상세 주소를 입력하세요">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">관리소장명</label>
                        <input type="text" class="form-input" placeholder="관리소장 이름">
                    </div>
                    <div class="form-group">
                        <label class="form-label">연락처</label>
                        <input type="text" class="form-input" placeholder="010-0000-0000">
                    </div>
                </div>

                <div class="form-divider"></div>
                <div class="form-section-title">공사 정보 <span class="form-section-optional">(선택)</span></div>
                
                <div class="form-group">
                    <label class="form-label">공사 종류</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" value="아스팔트슁글 방수">
                            <span class="checkbox-label">아스팔트슁글 방수</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="금속기와 방수">
                            <span class="checkbox-label">금속기와 방수</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="슬라브-듀얼">
                            <span class="checkbox-label">슬라브-듀얼</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="슬라브-우레탄">
                            <span class="checkbox-label">슬라브-우레탄</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="슬라브-PVC">
                            <span class="checkbox-label">슬라브-PVC</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="외벽 재도장 및 균열보수">
                            <span class="checkbox-label">외벽 재도장 및 균열보수</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="지하주차장 에폭시">
                            <span class="checkbox-label">지하주차장 에폭시</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="지하주차장 방수">
                            <span class="checkbox-label">지하주차장 방수</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="아스콘">
                            <span class="checkbox-label">아스콘</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="보도블럭">
                            <span class="checkbox-label">보도블럭</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">준공 일자</label>
                        <input type="date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">계약 금액</label>
                        <input type="text" class="form-input" placeholder="예: 5억원">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">향후 공사 제안사항</label>
                    <textarea class="form-input form-textarea" placeholder="다음에 공사하면 좋을 것 같은 내용을 기록하세요&#10;예: 외벽 도장 상태 확인 필요, 옥상 방수층 재시공 검토"></textarea>
                </div>

                <div class="form-divider"></div>
                <div class="form-section-title">특이사항</div>
                <div class="form-group">
                    <label class="form-label">특이사항 메모</label>
                    <textarea class="form-input form-textarea" placeholder="특이사항이 있으면 입력하세요"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addComplexModal')">취소</button>
                <button class="btn btn-primary">단지 추가</button>
            </div>
        </div>
    </div>

    <!-- Add Visit Modal -->
    <div class="modal-overlay" id="addVisitModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">방문 기록 추가</h2>
                <button class="modal-close" onclick="closeModal('addVisitModal')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">방문일 <span class="required">*</span></label>
                        <input type="date" class="form-input" id="visitDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">방문자 <span class="required">*</span></label>
                        <select class="form-input" id="visitVisitor">
                            <option value="">선택하세요</option>
                            <option value="김철수">김철수</option>
                            <option value="박영희">박영희</option>
                            <option value="이민호">이민호</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">방문 목적 <span class="required">*</span></label>
                    <select class="form-input" id="visitPurpose">
                        <option value="">선택하세요</option>
                        <option value="정기점검">정기점검</option>
                        <option value="하자점검">하자점검</option>
                        <option value="민원처리">민원처리</option>
                        <option value="긴급출동">긴급출동</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">하자 구분</label>
                    <select class="form-input" id="visitDefectType">
                        <option value="">선택하세요 (선택사항)</option>
                        <option value="균열">균열</option>
                        <option value="누수">누수</option>
                        <option value="방수">방수</option>
                        <option value="박리">박리</option>
                        <option value="침하">침하</option>
                        <option value="파손">파손</option>
                        <option value="기타">기타</option>
                    </select>
                </div>

                <div class="form-divider"></div>
                
                <div class="form-group">
                    <label class="form-label">범위 선택 <span class="required">*</span></label>
                    <div class="scope-select-group">
                        <input type="checkbox" id="scope_exterior" class="scope-checkbox" onchange="toggleChecklist('exterior')">
                        <label for="scope_exterior" class="scope-label">외벽</label>
                        
                        <input type="checkbox" id="scope_parking" class="scope-checkbox" onchange="toggleChecklist('parking')">
                        <label for="scope_parking" class="scope-label">지하주차장</label>
                        
                        <input type="checkbox" id="scope_roof" class="scope-checkbox" onchange="toggleChecklist('roof')">
                        <label for="scope_roof" class="scope-label">지붕</label>
                        
                        <input type="checkbox" id="scope_rooftop" class="scope-checkbox" onchange="toggleChecklist('rooftop')">
                        <label for="scope_rooftop" class="scope-label">옥상</label>
                        
                        <input type="checkbox" id="scope_ascon" class="scope-checkbox" onchange="toggleChecklist('ascon')">
                        <label for="scope_ascon" class="scope-label">아스콘</label>
                        
                        <input type="checkbox" id="scope_block" class="scope-checkbox" onchange="toggleChecklist('block')">
                        <label for="scope_block" class="scope-label">보도블럭</label>
                    </div>
                </div>

                <!-- 외벽 체크리스트 -->
                <div class="checklist-container" id="checklist_exterior">
                    <div class="checklist-scope-title">외벽 점검 체크리스트</div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">외벽</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>헤어크랙</td>
                                    <td><input type="radio" name="ext_wall_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>구조/사선 균열</td>
                                    <td><input type="radio" name="ext_wall_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>균열 반복</td>
                                    <td><input type="radio" name="ext_wall_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>백화/염분</td>
                                    <td><input type="radio" name="ext_wall_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>박리(도장들뜸)</td>
                                    <td><input type="radio" name="ext_wall_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>슬라브 라인 연계</td>
                                    <td><input type="radio" name="ext_wall_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="ext_wall_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_wall_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="checklist-divider"></div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">공용창 코킹</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>코킹 경화/갈라짐</td>
                                    <td><input type="radio" name="ext_caulk_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>코킹 단절</td>
                                    <td><input type="radio" name="ext_caulk_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>모서리 접합부</td>
                                    <td><input type="radio" name="ext_caulk_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>프레임 뒤 물자국</td>
                                    <td><input type="radio" name="ext_caulk_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>덧방 시공 흔적</td>
                                    <td><input type="radio" name="ext_caulk_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>외벽→창호 물흐름</td>
                                    <td><input type="radio" name="ext_caulk_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="ext_caulk_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ext_caulk_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 지하주차장 체크리스트 -->
                <div class="checklist-container" id="checklist_parking">
                    <div class="checklist-scope-title">지하주차장 점검 체크리스트</div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">바닥</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>크랙</td>
                                    <td><input type="radio" name="park_floor_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>박리</td>
                                    <td><input type="radio" name="park_floor_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>물고임</td>
                                    <td><input type="radio" name="park_floor_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>상부 구조 연계</td>
                                    <td><input type="radio" name="park_floor_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>차량 동선 중첩</td>
                                    <td><input type="radio" name="park_floor_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>결빙 흔적</td>
                                    <td><input type="radio" name="park_floor_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="park_floor_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_floor_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="checklist-divider"></div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">벽체</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>균열</td>
                                    <td><input type="radio" name="park_wall_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>젖음 자국</td>
                                    <td><input type="radio" name="park_wall_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>백화/녹물</td>
                                    <td><input type="radio" name="park_wall_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>수직 물흐름</td>
                                    <td><input type="radio" name="park_wall_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>관통부 인접</td>
                                    <td><input type="radio" name="park_wall_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>토압 방향 연계</td>
                                    <td><input type="radio" name="park_wall_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="park_wall_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_wall_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="checklist-divider"></div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">천정 누수</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>낙수 흔적</td>
                                    <td><input type="radio" name="park_ceil_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>변색</td>
                                    <td><input type="radio" name="park_ceil_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>확산 범위</td>
                                    <td><input type="radio" name="park_ceil_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>상부 사용 용도</td>
                                    <td><input type="radio" name="park_ceil_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>배관/드레인 연계</td>
                                    <td><input type="radio" name="park_ceil_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>계절성 반복</td>
                                    <td><input type="radio" name="park_ceil_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="park_ceil_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="park_ceil_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 지붕 체크리스트 -->
                <div class="checklist-container" id="checklist_roof">
                    <div class="checklist-scope-title">지붕 점검 체크리스트</div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">아스팔트슁글</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>탈락</td>
                                    <td><input type="radio" name="roof_shingle_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>겹침부 들뜸</td>
                                    <td><input type="radio" name="roof_shingle_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>못 노출</td>
                                    <td><input type="radio" name="roof_shingle_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>하부 방수층</td>
                                    <td><input type="radio" name="roof_shingle_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>물흐름 방향</td>
                                    <td><input type="radio" name="roof_shingle_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>처마/마감부</td>
                                    <td><input type="radio" name="roof_shingle_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="roof_shingle_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_shingle_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="checklist-divider"></div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">금속기와</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>탈락</td>
                                    <td><input type="radio" name="roof_metal_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>휘어짐</td>
                                    <td><input type="radio" name="roof_metal_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>못 노출</td>
                                    <td><input type="radio" name="roof_metal_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>스톤칩 탈락</td>
                                    <td><input type="radio" name="roof_metal_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>서까래 하자</td>
                                    <td><input type="radio" name="roof_metal_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>이음부 파손</td>
                                    <td><input type="radio" name="roof_metal_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="roof_metal_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="roof_metal_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 옥상 체크리스트 -->
                <div class="checklist-container" id="checklist_rooftop">
                    <div class="checklist-scope-title">옥상 점검 체크리스트</div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">슬라브</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>방수층 들뜸</td>
                                    <td><input type="radio" name="rooftop_slab_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>크랙</td>
                                    <td><input type="radio" name="rooftop_slab_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>드레인</td>
                                    <td><input type="radio" name="rooftop_slab_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>수분 잔존</td>
                                    <td><input type="radio" name="rooftop_slab_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>단차/코너부</td>
                                    <td><input type="radio" name="rooftop_slab_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>재시공 흔적</td>
                                    <td><input type="radio" name="rooftop_slab_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>물고임</td>
                                    <td><input type="radio" name="rooftop_slab_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="rooftop_slab_8" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_8" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="rooftop_slab_8" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 아스콘 체크리스트 -->
                <div class="checklist-container" id="checklist_ascon">
                    <div class="checklist-scope-title">아스콘 점검 체크리스트</div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">아스콘</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>거북등 균열</td>
                                    <td><input type="radio" name="ascon_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>침하</td>
                                    <td><input type="radio" name="ascon_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>재포장 흔적</td>
                                    <td><input type="radio" name="ascon_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>기층 손상 의심</td>
                                    <td><input type="radio" name="ascon_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>배수 경로</td>
                                    <td><input type="radio" name="ascon_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>중차량 통행</td>
                                    <td><input type="radio" name="ascon_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="ascon_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="ascon_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 보도블럭 체크리스트 -->
                <div class="checklist-container" id="checklist_block">
                    <div class="checklist-scope-title">보도블럭 점검 체크리스트</div>
                    
                    <div class="checklist-category">
                        <div class="checklist-category-title">보도블럭</div>
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>점검 항목</th>
                                    <th>정상</th>
                                    <th>주의</th>
                                    <th>관리필요</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>침하</td>
                                    <td><input type="radio" name="block_1" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_1" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_1" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>들뜸</td>
                                    <td><input type="radio" name="block_2" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_2" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_2" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>블럭 파손</td>
                                    <td><input type="radio" name="block_3" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_3" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_3" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>줄눈 유실</td>
                                    <td><input type="radio" name="block_4" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_4" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_4" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>하부 모래층 유실</td>
                                    <td><input type="radio" name="block_5" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_5" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_5" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td>동결융해</td>
                                    <td><input type="radio" name="block_6" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_6" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_6" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                                <tr>
                                    <td><strong>종합</strong></td>
                                    <td><input type="radio" name="block_7" value="정상" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_7" value="주의" class="checklist-radio"></td>
                                    <td><input type="radio" name="block_7" value="관리필요" class="checklist-radio"></td>
                                    <td><input type="text" class="checklist-note-input" placeholder="비고"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">방문 메모</label>
                    <textarea class="form-input form-textarea" id="visitMemo" placeholder="방문 내용을 상세히 기록하세요"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">사진 업로드</label>
                    <input type="file" class="form-input" id="visitPhotos" multiple accept="image/*" onchange="previewPhotos(this, 'photoPreview')">
                    <div class="photo-preview-container" id="photoPreview"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">다음 방문 예정일</label>
                    <input type="date" class="form-input" id="nextVisitDate">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addVisitModal')">취소</button>
                <button class="btn btn-primary" onclick="saveVisitRecord()">기록 저장</button>
            </div>
        </div>
    </div>

    <!-- 방문 기록 수정 모달 -->
    <div class="modal-overlay" id="editVisitModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">방문 기록 수정</h2>
                <button class="modal-close" onclick="closeModal('editVisitModal')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editVisitId">
                <div class="form-group">
                    <label class="form-label">방문일</label>
                    <input type="date" class="form-input" id="editVisitDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">방문 목적</label>
                    <select class="form-input" id="editVisitPurpose" required>
                        <option value="">선택하세요</option>
                        <option value="정기점검">정기점검</option>
                        <option value="하자점검">하자점검</option>
                        <option value="민원처리">민원처리</option>
                        <option value="긴급점검">긴급점검</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">하자 구분</label>
                    <input type="text" class="form-input" id="editDefectType" placeholder="예: 방수, 도장, 누수 등">
                </div>
                <div class="form-group">
                    <label class="form-label">방문 메모</label>
                    <textarea class="form-input form-textarea" id="editVisitMemo" placeholder="방문 내용을 상세히 기록하세요"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">다음 방문 예정일</label>
                    <input type="date" class="form-input" id="editNextVisitDate">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteVisitRecord()" style="margin-right: auto;">삭제</button>
                <button class="btn btn-secondary" onclick="closeModal('editVisitModal')">취소</button>
                <button class="btn btn-primary" onclick="updateVisitRecord()">수정 저장</button>
            </div>
        </div>
    </div>

    <!-- 일정 추가/수정 모달 -->
    <div class="modal-overlay" id="scheduleModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="scheduleModalTitle">일정 추가</h2>
                <button class="modal-close" onclick="closeModal('scheduleModal')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="scheduleId">
                <div class="form-group" id="scheduleComplexGroup">
                    <label class="form-label">단지 선택</label>
                    <select class="form-input" id="scheduleComplex" required>
                        <option value="">단지를 선택하세요</option>
                    </select>
                </div>
                <div class="form-group" id="scheduleAssigneeGroup">
                    <label class="form-label">담당자</label>
                    <select class="form-input" id="scheduleAssignee" required>
                        <option value="">담당자를 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">일정 제목</label>
                    <input type="text" class="form-input" id="scheduleTitle" placeholder="일정 제목을 입력하세요" required>
                </div>
                <div class="form-group">
                    <label class="form-label">일정 날짜</label>
                    <input type="date" class="form-input" id="scheduleDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">일정 유형</label>
                    <select class="form-input" id="scheduleType" required>
                        <option value="">선택하세요</option>
                        <option value="visit">방문 예정</option>
                        <option value="deadline">마감</option>
                        <option value="reminder">리마인더</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">설명</label>
                    <textarea class="form-input form-textarea" id="scheduleDesc" placeholder="일정에 대한 설명"></textarea>
                </div>
            </div>
            <div class="modal-footer" id="scheduleModalFooter">
                <button class="btn btn-secondary" onclick="closeModal('scheduleModal')">취소</button>
                <button class="btn btn-primary" onclick="saveSchedule()">저장</button>
            </div>
        </div>
    </div>

    <!-- 담당자 추가/수정 모달 -->
    <div class="modal-overlay" id="userModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="userModalTitle">담당자 추가</h2>
                <button class="modal-close" onclick="closeModal('userModal')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label class="form-label">이름 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="userName2" placeholder="이름을 입력하세요" required>
                </div>
                <div class="form-group">
                    <label class="form-label">아이디 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="userEmail" placeholder="아이디를 입력하세요" required>
                </div>
                <div class="form-group">
                    <label class="form-label">비밀번호 <span class="required" id="pwdRequired">*</span></label>
                    <input type="password" class="form-input" id="userPassword" placeholder="비밀번호 (수정 시 빈칸이면 유지)">
                </div>
                <div class="form-group">
                    <label class="form-label">연락처</label>
                    <input type="text" class="form-input" id="userPhone" placeholder="010-1234-5678">
                </div>
                <div class="form-group">
                    <label class="form-label">역할 <span class="required">*</span></label>
                    <select class="form-input" id="userRole2" required>
                        <option value="">선택하세요</option>
                        <option value="관리자">관리자</option>
                        <option value="대표">대표</option>
                        <option value="팀장">팀장</option>
                        <option value="팀원">팀원</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer" id="userModalFooter">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">취소</button>
                <button class="btn btn-primary" onclick="saveUser()">저장</button>
            </div>
        </div>
    </div>

    <!-- 단지 정보 수정 모달 -->
    <div class="modal-overlay" id="editComplexModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">단지 정보 수정</h2>
                <button class="modal-close" onclick="closeModal('editComplexModal')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">관리소장</label>
                    <input type="text" class="form-input" id="editCaretaker" placeholder="관리소장 이름">
                </div>
                <div class="form-group">
                    <label class="form-label">관리소 연락처</label>
                    <input type="text" class="form-input" id="editCaretakerPhone" placeholder="02-1234-5678">
                </div>
                <div class="form-group">
                    <label class="form-label">특이사항</label>
                    <textarea class="form-input form-textarea" id="editComplexMemo" placeholder="단지 관련 특이사항"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editComplexModal')">취소</button>
                <button class="btn btn-primary" onclick="saveComplexInfo()">저장</button>
            </div>
        </div>
    </div>

    <script>
        // ===== Supabase 설정 =====
        const SUPABASE_URL = 'https://wcxxtugrzjqvehkekzvp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjeHh0dWdyempxdmVoa2VrenZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NDgyMjksImV4cCI6MjA4MzMyNDIyOX0.wNYu-oz-huxW0mTPPg1EuBiU5rMEPiwhA3zn-4aTEB8';
        
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 전역 변수
        let currentUser = null;
        let complexData = [];
        let visitData = [];
        let currentComplex = null;
        let currentMonth = new Date();

        // 이름에서 성 제외한 이름 2글자 추출 (김범석 → 범석)
        function getAvatarName(fullName) {
            if (!fullName) return '?';
            // 한국 이름: 성(1글자) + 이름(2글자) = 3글자가 일반적
            if (fullName.length === 3) {
                return fullName.slice(1); // 성 제외
            } else if (fullName.length === 2) {
                return fullName; // 2글자면 그대로
            } else if (fullName.length === 4) {
                return fullName.slice(1, 3); // 4글자면 성 제외 후 2글자
            } else {
                return fullName.slice(0, 2); // 그 외는 앞 2글자
            }
        }

        // 관리자 권한 체크 (전체 접근 가능)
        function isAdmin() {
            return currentUser && currentUser.role === '관리자';
        }

        // ===== 시크릿 모드 (고객용 뷰어) =====
        let secretModeActive = false;

        function toggleSecretMode() {
            secretModeActive = !secretModeActive;
            const detailPage = document.getElementById('detailPage');
            const btn = document.getElementById('secretModeBtn');
            const text = document.getElementById('secretModeText');

            if (secretModeActive) {
                detailPage.classList.add('secret-mode');
                btn.classList.add('active');
                text.textContent = '고객용 뷰어 ON';
            } else {
                detailPage.classList.remove('secret-mode');
                btn.classList.remove('active');
                text.textContent = '고객용 뷰어';
            }
        }

        // ===== 사진 관련 함수 =====
        // 사진 미리보기
        function previewPhotos(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (input.files) {
                Array.from(input.files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'photo-preview-item';
                        div.innerHTML = `
                            <img src="${e.target.result}" alt="미리보기">
                            <button class="photo-preview-remove" onclick="removePreviewPhoto(${index}, '${input.id}', '${previewId}')">×</button>
                        `;
                        preview.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        // 미리보기 사진 제거
        function removePreviewPhoto(index, inputId, previewId) {
            const input = document.getElementById(inputId);
            const dt = new DataTransfer();
            const files = input.files;
            
            for (let i = 0; i < files.length; i++) {
                if (i !== index) {
                    dt.items.add(files[i]);
                }
            }
            input.files = dt.files;
            previewPhotos(input, previewId);
        }

        // 파일을 base64로 변환
        async function getPhotosBase64(inputId) {
            const input = document.getElementById(inputId);
            const photos = [];
            
            if (input && input.files) {
                for (const file of input.files) {
                    const base64 = await fileToBase64(file);
                    photos.push({
                        name: file.name,
                        type: file.type,
                        data: base64
                    });
                }
            }
            return photos;
        }

        // 파일을 base64로 변환 (Promise)
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // 사진 확대 모달
        function openPhotoModal(src) {
            const modal = document.createElement('div');
            modal.className = 'photo-modal';
            modal.onclick = () => modal.remove();
            modal.innerHTML = `
                <button class="photo-modal-close" onclick="this.parentElement.remove()">×</button>
                <img src="${src}" alt="확대 사진">
            `;
            document.body.appendChild(modal);
        }

        // ===== 댓글 관련 함수 =====
        // 댓글 토글
        async function toggleComments(visitId) {
            const commentsDiv = document.getElementById(`comments-${visitId}`);
            if (commentsDiv.style.display === 'none') {
                commentsDiv.style.display = 'block';
                await loadComments(visitId);
            } else {
                commentsDiv.style.display = 'none';
            }
        }

        // 댓글 로드
        async function loadComments(visitId) {
            try {
                const { data, error } = await supabaseClient
                    .from('comments')
                    .select(`
                        *,
                        user:users!comments_user_id_fkey(id, name)
                    `)
                    .eq('visit_record_id', visitId)
                    .order('created_at', { ascending: true });

                if (error) throw error;

                const listEl = document.getElementById(`comments-list-${visitId}`);
                if (data.length === 0) {
                    listEl.innerHTML = '<div class="empty-comments">댓글이 없습니다.</div>';
                } else {
                    listEl.innerHTML = data.map(c => {
                        const avatarName = getAvatarName(c.user?.name);
                        return `
                            <div class="comment-item">
                                <div class="comment-avatar">${avatarName}</div>
                                <div class="comment-content">
                                    <div class="comment-header">
                                        <span class="comment-author">${c.user?.name || '-'}</span>
                                        <span class="comment-date">${formatDateTime(c.created_at)}</span>
                                        ${c.user_id === currentUser.id ? `<button class="comment-delete" onclick="deleteComment('${c.id}', '${visitId}')">삭제</button>` : ''}
                                    </div>
                                    <div class="comment-text">${c.content}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            } catch (err) {
                console.error('댓글 로드 실패:', err);
            }
        }

        // 댓글 추가
        async function addComment(visitId) {
            const input = document.getElementById(`comment-input-${visitId}`);
            const content = input.value.trim();
            
            if (!content) {
                alert('댓글 내용을 입력해주세요.');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('comments')
                    .insert({
                        complex_id: currentComplex.id,
                        visit_record_id: visitId,
                        user_id: currentUser.id,
                        content: content
                    });

                if (error) throw error;

                input.value = '';
                await loadComments(visitId);
            } catch (err) {
                console.error('댓글 추가 실패:', err);
                alert('댓글 추가에 실패했습니다.');
            }
        }

        // 댓글 삭제
        async function deleteComment(commentId, visitId) {
            if (!confirm('이 댓글을 삭제하시겠습니까?')) return;

            try {
                const { error } = await supabaseClient
                    .from('comments')
                    .delete()
                    .eq('id', commentId);

                if (error) throw error;
                await loadComments(visitId);
            } catch (err) {
                console.error('댓글 삭제 실패:', err);
                alert('댓글 삭제에 실패했습니다.');
            }
        }

        // 날짜시간 포맷
        function formatDateTime(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return '방금 전';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}분 전`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}시간 전`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)}일 전`;
            
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        // ===== 단지 정보 수정 =====
        function openEditComplexModal() {
            document.getElementById('editCaretaker').value = currentComplex.caretaker || '';
            document.getElementById('editCaretakerPhone').value = currentComplex.caretakerPhone || '';
            document.getElementById('editComplexMemo').value = currentComplex.memo || '';
            openModal('editComplexModal');
        }

        async function saveComplexInfo() {
            const caretaker = document.getElementById('editCaretaker').value;
            const caretakerPhone = document.getElementById('editCaretakerPhone').value;
            const memo = document.getElementById('editComplexMemo').value;

            try {
                const { error } = await supabaseClient
                    .from('complexes')
                    .update({
                        caretaker_name: caretaker || null,
                        caretaker_phone: caretakerPhone || null,
                        memo: memo || null
                    })
                    .eq('id', currentComplex.id);

                if (error) throw error;

                // 로컬 데이터 업데이트
                currentComplex.caretaker = caretaker || '-';
                currentComplex.caretakerPhone = caretakerPhone || '-';
                currentComplex.memo = memo;

                closeModal('editComplexModal');
                renderDetailHeader();
                await loadComplexes();
                alert('단지 정보가 수정되었습니다.');
            } catch (err) {
                console.error('단지 정보 수정 실패:', err);
                alert('수정에 실패했습니다.');
            }
        }

        // ===== 단지 상태 변경 =====
        async function changeComplexStatus(newStatus) {
            try {
                const { error } = await supabaseClient
                    .from('complexes')
                    .update({ status: newStatus })
                    .eq('id', currentComplex.id);

                if (error) throw error;

                currentComplex.status = newStatus;
                await loadComplexes();
                updateStats();
            } catch (err) {
                console.error('상태 변경 실패:', err);
                alert('상태 변경에 실패했습니다.');
            }
        }

        // ===== 담당자 관리 =====
        let allUsersData = [];

        // 대시보드 페이지 표시
        async function showDashboardPage() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('calendarPage').classList.add('hidden');
            document.getElementById('usersPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            document.getElementById('detailPage').classList.remove('active');
            currentComplex = null;
            
            // 네비게이션 활성화
            document.getElementById('navComplexList').classList.remove('active');
            document.getElementById('navCalendar').classList.remove('active');
            const navUsers = document.getElementById('navUsers');
            if (navUsers) navUsers.classList.remove('active');
            document.getElementById('navDashboard').classList.add('active');
            
            await loadDashboardData();
        }

        // 대시보드 데이터 로드
        async function loadDashboardData() {
            try {
                // 단지 통계
                const total = complexData.length;
                const normal = complexData.filter(c => c.status === '정상').length;
                const tracking = complexData.filter(c => c.status === '추적 필요').length;
                const revisit = complexData.filter(c => c.status === '재방문 필요').length;

                document.getElementById('dashTotalComplex').textContent = total;
                document.getElementById('dashNormalComplex').textContent = normal;
                document.getElementById('dashTrackingComplex').textContent = tracking;
                document.getElementById('dashRevisitComplex').textContent = revisit;

                // 월별 방문 현황 차트
                renderVisitChart();

                // 상태 분포 차트
                renderStatusChart(normal, tracking, revisit);

                // 최근 방문 기록
                await loadRecentVisits();
            } catch (err) {
                console.error('대시보드 로드 실패:', err);
            }
        }

        // 월별 방문 현황 차트 렌더링
        async function renderVisitChart() {
            const chartEl = document.getElementById('visitChart');
            
            // 최근 6개월 방문 수 가져오기
            const months = [];
            const now = new Date();
            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                months.push({
                    year: d.getFullYear(),
                    month: d.getMonth() + 1,
                    label: `${d.getMonth() + 1}월`
                });
            }

            // 방문 기록 가져오기
            const { data, error } = await supabaseClient
                .from('visit_records')
                .select('visit_date');

            let visitCounts = months.map(() => 0);
            
            if (!error && data) {
                data.forEach(v => {
                    const d = new Date(v.visit_date);
                    const idx = months.findIndex(m => m.year === d.getFullYear() && m.month === d.getMonth() + 1);
                    if (idx !== -1) visitCounts[idx]++;
                });
            }

            const maxCount = Math.max(...visitCounts, 1);

            chartEl.innerHTML = months.map((m, i) => `
                <div class="chart-bar-container">
                    <div class="chart-bar-value">${visitCounts[i]}</div>
                    <div class="chart-bar" style="height: ${(visitCounts[i] / maxCount) * 180}px;"></div>
                    <div class="chart-bar-label">${m.label}</div>
                </div>
            `).join('');
        }

        // 상태 분포 차트 렌더링 (토스 스타일 도넛)
        function renderStatusChart(normal, tracking, revisit) {
            const chartEl = document.getElementById('statusChart');
            const total = normal + tracking + revisit || 1;

            // 가장 큰 비율 찾기
            const maxCount = Math.max(normal, tracking, revisit);
            let mainPct, mainLabel, mainColor;
            
            if (normal === maxCount) {
                mainPct = Math.round((normal / total) * 100);
                mainLabel = '정상';
                mainColor = '#3182f6';
            } else if (tracking === maxCount) {
                mainPct = Math.round((tracking / total) * 100);
                mainLabel = '추적 필요';
                mainColor = '#f97316';
            } else {
                mainPct = Math.round((revisit / total) * 100);
                mainLabel = '재방문 필요';
                mainColor = '#ef4444';
            }

            // SVG 도넛 차트
            const radius = 50;
            const circumference = 2 * Math.PI * radius;
            const dashLength = (mainPct / 100) * circumference;

            chartEl.innerHTML = `
                <div class="donut-status-container">
                    <div class="donut-status-chart">
                        <svg viewBox="0 0 120 120">
                            <circle cx="60" cy="60" r="${radius}" fill="none" stroke="#e5e7eb" stroke-width="12"/>
                            <circle cx="60" cy="60" r="${radius}" fill="none" stroke="${mainColor}" stroke-width="12" stroke-dasharray="${dashLength} ${circumference}" stroke-dashoffset="${circumference * 0.25}" stroke-linecap="round"/>
                        </svg>
                        <div class="donut-status-center">
                            <div class="donut-status-pct" style="color: ${mainColor}">${mainPct}%</div>
                            <div class="donut-status-label">${mainLabel}</div>
                        </div>
                    </div>
                    <div class="donut-status-list">
                        <div class="donut-status-item">
                            <span class="donut-status-name">정상</span>
                            <span class="donut-status-count" style="color: #3182f6">${normal}</span>
                        </div>
                        <div class="donut-status-item">
                            <span class="donut-status-name">추적 필요</span>
                            <span class="donut-status-count" style="color: #f97316">${tracking}</span>
                        </div>
                        <div class="donut-status-item">
                            <span class="donut-status-name">재방문 필요</span>
                            <span class="donut-status-count" style="color: #ef4444">${revisit}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // 최근 방문 기록 로드
        async function loadRecentVisits() {
            const listEl = document.getElementById('dashRecentVisits');

            try {
                // 모든 계정에서 전체 방문 기록 조회 가능
                let query = supabaseClient
                    .from('visit_records')
                    .select(`
                        *,
                        visitor:users!visit_records_visitor_id_fkey(id, name),
                        complex:complexes!visit_records_complex_id_fkey(id, name)
                    `)
                    .order('visit_date', { ascending: false })
                    .limit(10);

                const { data, error } = await query;

                if (error) throw error;

                if (!data || data.length === 0) {
                    listEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">최근 방문 기록이 없습니다.</div>';
                    return;
                }

                listEl.innerHTML = data.map(v => {
                    const avatarName = getAvatarName(v.visitor?.name);
                    return `
                        <div class="dashboard-activity-item">
                            <div class="dashboard-activity-avatar">${avatarName}</div>
                            <div class="dashboard-activity-info">
                                <div class="dashboard-activity-title">${v.complex?.name || '-'}</div>
                                <div class="dashboard-activity-desc">${v.purpose} · ${v.visitor?.name || '-'}</div>
                            </div>
                            <div class="dashboard-activity-time">${formatDate(v.visit_date)}</div>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                console.error('최근 방문 로드 실패:', err);
            }
        }

        // 담당자 관리 페이지 표시
        async function showUsersPage() {
            // 관리자만 접근 가능
            if (!isAdmin()) {
                alert('관리자만 접근할 수 있습니다.');
                return;
            }

            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('calendarPage').classList.add('hidden');
            document.getElementById('usersPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('detailPage').classList.remove('active');
            currentComplex = null;
            
            // 네비게이션 활성화
            document.getElementById('navComplexList').classList.remove('active');
            document.getElementById('navCalendar').classList.remove('active');
            document.getElementById('navUsers').classList.add('active');
            const navDashboard = document.getElementById('navDashboard');
            if (navDashboard) navDashboard.classList.remove('active');
            
            await loadAllUsers();
        }

        // 모든 담당자 로드
        async function loadAllUsers() {
            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .order('name');

                if (error) throw error;

                allUsersData = data;

                // 각 담당자별 담당 단지 수 계산
                const { data: complexCounts, error: countError } = await supabaseClient
                    .from('complexes')
                    .select('manager_id');

                const countMap = {};
                if (!countError && complexCounts) {
                    complexCounts.forEach(c => {
                        if (c.manager_id) {
                            countMap[c.manager_id] = (countMap[c.manager_id] || 0) + 1;
                        }
                    });
                }

                renderUsersGrid(allUsersData, countMap);
            } catch (err) {
                console.error('담당자 로드 실패:', err);
            }
        }

        // 담당자 그리드 렌더링
        function renderUsersGrid(users, countMap = {}) {
            const grid = document.getElementById('usersGrid');
            
            grid.innerHTML = users.map(user => {
                const roleClass = user.role === '관리자' ? 'admin' : user.role === '대표' ? 'admin' : user.role === '팀장' ? 'manager' : 'member';
                const complexCount = countMap[user.id] || 0;
                const avatarName = getAvatarName(user.name);
                
                return `
                    <div class="user-card">
                        <div class="user-card-header">
                            <div class="user-card-avatar">${avatarName}</div>
                            <div class="user-card-info">
                                <h3>${user.name}</h3>
                                <span class="user-card-role ${roleClass}">${user.role}</span>
                            </div>
                        </div>
                        <div class="user-card-details">
                            <div class="user-card-detail">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                @${user.email}
                            </div>
                            <div class="user-card-detail">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                </svg>
                                ${user.phone || '-'}
                            </div>
                        </div>
                        <div class="user-card-stats">
                            <div class="user-card-stat">
                                <div class="user-card-stat-value">${complexCount}</div>
                                <div class="user-card-stat-label">담당 단지</div>
                            </div>
                        </div>
                        <div class="user-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="openEditUserModal('${user.id}')">수정</button>
                            ${user.id !== currentUser.id ? `<button class="btn btn-danger btn-sm" onclick="deleteUser('${user.id}')">삭제</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 담당자 추가 모달 열기
        function openAddUserModal() {
            document.getElementById('userModalTitle').textContent = '담당자 추가';
            document.getElementById('editUserId').value = '';
            document.getElementById('userName2').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('userRole2').value = '';
            document.getElementById('pwdRequired').style.display = 'inline';
            
            document.getElementById('userModalFooter').innerHTML = `
                <button class="btn btn-secondary" onclick="closeModal('userModal')">취소</button>
                <button class="btn btn-primary" onclick="saveUser()">저장</button>
            `;
            
            openModal('userModal');
        }

        // 담당자 수정 모달 열기
        function openEditUserModal(userId) {
            const user = allUsersData.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('userModalTitle').textContent = '담당자 수정';
            document.getElementById('editUserId').value = user.id;
            document.getElementById('userName2').value = user.name;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('userPassword').value = '';
            document.getElementById('userPhone').value = user.phone || '';
            document.getElementById('userRole2').value = user.role;
            document.getElementById('pwdRequired').style.display = 'none';
            
            document.getElementById('userModalFooter').innerHTML = `
                <button class="btn btn-secondary" onclick="closeModal('userModal')">취소</button>
                <button class="btn btn-primary" onclick="saveUser()">수정 저장</button>
            `;
            
            openModal('userModal');
        }

        // 담당자 저장
        async function saveUser() {
            const id = document.getElementById('editUserId').value;
            const name = document.getElementById('userName2').value;
            const email = document.getElementById('userEmail').value;
            const password = document.getElementById('userPassword').value;
            const phone = document.getElementById('userPhone').value;
            const role = document.getElementById('userRole2').value;

            if (!name || !email || !role) {
                alert('필수 항목을 입력해주세요.');
                return;
            }

            if (!id && !password) {
                alert('새 담당자는 비밀번호가 필수입니다.');
                return;
            }

            try {
                if (id) {
                    // 수정
                    const updateData = {
                        name: name,
                        email: email,
                        phone: phone || null,
                        role: role
                    };
                    
                    if (password) {
                        updateData.password = password;
                    }

                    const { error } = await supabaseClient
                        .from('users')
                        .update(updateData)
                        .eq('id', id);

                    if (error) throw error;
                    alert('담당자 정보가 수정되었습니다.');
                } else {
                    // 추가
                    const { error } = await supabaseClient
                        .from('users')
                        .insert({
                            name: name,
                            email: email,
                            password: password,
                            phone: phone || null,
                            role: role
                        });

                    if (error) throw error;
                    alert('담당자가 추가되었습니다.');
                }

                closeModal('userModal');
                usersCache = null; // 캐시 초기화
                await loadAllUsers();
            } catch (err) {
                console.error('담당자 저장 실패:', err);
                alert('저장에 실패했습니다.');
            }
        }

        // 담당자 삭제
        async function deleteUser(userId) {
            if (!confirm('이 담당자를 삭제하시겠습니까?\n담당 단지가 있으면 담당자가 해제됩니다.')) return;

            try {
                // 담당 단지 해제
                await supabaseClient
                    .from('complexes')
                    .update({ manager_id: null })
                    .eq('manager_id', userId);

                // 사용자 삭제
                const { error } = await supabaseClient
                    .from('users')
                    .delete()
                    .eq('id', userId);

                if (error) throw error;

                usersCache = null;
                await loadAllUsers();
                alert('담당자가 삭제되었습니다.');
            } catch (err) {
                console.error('담당자 삭제 실패:', err);
                alert('삭제에 실패했습니다.');
            }
        }

        // ===== 로그인 =====
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            await login(email, password);
        });

        async function login(email, password) {
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            
            loginBtn.disabled = true;
            loginBtn.textContent = '로그인 중...';
            loginError.classList.remove('show');

            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('email', email)
                    .eq('password', password)
                    .single();

                if (error || !data) {
                    throw new Error('로그인 실패');
                }

                currentUser = data;
                localStorage.setItem('currentUser', JSON.stringify(data));
                
                showApp();
            } catch (err) {
                console.error('로그인 에러:', err);
                loginError.classList.add('show');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = '로그인';
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }

        // ===== 앱 표시 =====
        async function showApp() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            
            // 사용자 정보 표시
            const avatarName = getAvatarName(currentUser.name);
            document.getElementById('userAvatar').textContent = avatarName;
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = isAdmin() ? currentUser.role : '사후관리팀 ' + currentUser.role;
            
            // 페이지 서브타이틀 업데이트
            document.getElementById('pageSubtitle').textContent = '전국 관리 단지 현황을 한눈에 확인하세요';
            
            // 데이터 로드
            await loadComplexes();
            
            // 알림 로드 (실제 일정 기반)
            await loadNotifications();
        }

        // ===== 단지 목록 로드 (DB) =====
        async function loadComplexes() {
            try {
                // 모든 계정에서 전체 단지 조회 가능
                let query = supabaseClient
                    .from('complexes')
                    .select(`
                        *,
                        manager:users!complexes_manager_id_fkey(id, name, phone)
                    `)
                    .order('name');

                const { data, error } = await query;

                if (error) throw error;

                // DB 데이터를 기존 형식으로 변환
                complexData = data.map(c => ({
                    id: c.id,
                    name: c.name,
                    region: c.region,
                    address: c.address,
                    manager: c.manager?.name || '-',
                    managerId: c.manager_id,
                    lastVisit: c.last_visit_date,
                    status: c.status,
                    managerPhone: c.manager?.phone || '-',
                    caretaker: c.caretaker_name || '-',
                    caretakerPhone: c.caretaker_phone || '-',
                    memo: c.memo || '',
                    constructionTypes: c.construction_types || []
                }));

                // 담당자 필터 옵션 먼저 로드
                await loadManagerFilter();
                
                // 필터링된 데이터로 렌더링
                applyFilters();
                setupSearch();
            } catch (err) {
                console.error('단지 로드 실패:', err);
            }
        }

        // ===== 필터 적용 함수 =====
        function applyFilters() {
            const searchInput = document.getElementById('searchInput');
            const regionFilter = document.getElementById('regionFilter');
            const statusFilter = document.getElementById('statusFilter');
            const managerFilter = document.getElementById('managerFilter');

            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const region = regionFilter ? regionFilter.value : '';
            const status = statusFilter ? statusFilter.value : '';
            const managerId = managerFilter ? managerFilter.value : '';

            const filtered = complexData.filter(complex => {
                const matchSearch = complex.name.toLowerCase().includes(searchTerm) || 
                                   complex.address.toLowerCase().includes(searchTerm);
                const matchRegion = !region || complex.region === region;
                const matchStatus = !status || complex.status === status;
                const matchManager = !managerId || complex.managerId === managerId;
                return matchSearch && matchRegion && matchStatus && matchManager;
            });

            renderComplexGrid(filtered);
            updateStats(filtered);
        }

        // ===== 담당자 필터 옵션 로드 =====
        async function loadManagerFilter() {
            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('id, name, role')
                    .in('role', ['대표', '팀장']);

                if (error) throw error;

                // 원하는 순서로 정렬: 이승우, 황윤선, 조재연, 한준엽, 이필선, 김성민
                const orderMap = {
                    '이승우': 1,
                    '황윤선': 2,
                    '조재연': 3,
                    '한준엽': 4,
                    '이필선': 5,
                    '김성민': 6
                };
                
                const sortedData = data.sort((a, b) => {
                    const orderA = orderMap[a.name] || 99;
                    const orderB = orderMap[b.name] || 99;
                    return orderA - orderB;
                });

                const managerFilter = document.getElementById('managerFilter');
                const calendarManagerFilter = document.getElementById('calendarManagerFilter');
                
                const options = sortedData.map(u => `<option value="${u.id}">${u.name}</option>`).join('');
                
                if (managerFilter) {
                    managerFilter.innerHTML = `<option value="">전체 담당자</option>${options}`;
                    // 관리자가 아니면 본인 계정으로 기본 선택
                    if (!isAdmin() && currentUser) {
                        managerFilter.value = currentUser.id;
                    }
                }
                if (calendarManagerFilter) {
                    calendarManagerFilter.innerHTML = `<option value="">전체 담당자</option>${options}`;
                    // 관리자가 아니면 본인 계정으로 기본 선택
                    if (!isAdmin() && currentUser) {
                        calendarManagerFilter.value = currentUser.id;
                    }
                }
            } catch (err) {
                console.error('담당자 목록 로드 실패:', err);
            }
        }

        // ===== 방문 기록 로드 (DB) =====
        async function loadVisitData(complexId) {
            try {
                const { data, error } = await supabaseClient
                    .from('visit_records')
                    .select(`
                        *,
                        visitor:users!visit_records_visitor_id_fkey(id, name)
                    `)
                    .eq('complex_id', complexId)
                    .order('visit_date', { ascending: false });

                if (error) throw error;

                // DB 데이터를 기존 형식으로 변환 (id 포함)
                visitData = data.map(v => ({
                    id: v.id,
                    date: v.visit_date,
                    visitor: v.visitor?.name || '-',
                    purpose: v.purpose,
                    defectType: v.defect_type,
                    memo: v.memo,
                    photos: v.photos || [],
                    aiDiagnosis: null,
                    nextVisit: v.next_visit_date
                }));

                return visitData;
            } catch (err) {
                console.error('방문 기록 로드 실패:', err);
                return [];
            }
        }

        // ===== 방문 기록 저장 (DB) =====
        async function saveVisitRecord() {
            const visitDate = document.getElementById('visitDate').value;
            const visitPurpose = document.getElementById('visitPurpose').value;
            const visitMemo = document.getElementById('visitMemo').value;
            const visitDefectType = document.getElementById('visitDefectType').value;
            const nextVisitDate = document.getElementById('nextVisitDate').value;
            
            // 사진 데이터 가져오기
            const photos = await getPhotosBase64('visitPhotos');

            if (!visitDate || !visitPurpose) {
                alert('방문일과 방문 목적을 입력해주세요.');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('visit_records')
                    .insert({
                        complex_id: currentComplex.id,
                        visitor_id: currentUser.id,
                        visit_date: visitDate,
                        purpose: visitPurpose,
                        defect_type: visitDefectType || null,
                        memo: visitMemo || null,
                        next_visit_date: nextVisitDate || null,
                        photos: photos.length > 0 ? photos : null
                    });

                if (error) throw error;

                // 단지의 최근 방문일 업데이트
                await supabaseClient
                    .from('complexes')
                    .update({ last_visit_date: visitDate })
                    .eq('id', currentComplex.id);

                // 다음 방문 예정일이 있으면 일정에 자동 추가
                if (nextVisitDate) {
                    await supabaseClient
                        .from('schedules')
                        .insert({
                            complex_id: currentComplex.id,
                            user_id: currentUser.id,
                            title: `${currentComplex.name} 방문 예정`,
                            schedule_date: nextVisitDate,
                            schedule_type: 'visit',
                            description: `${visitPurpose} 후속 방문`
                        });
                }

                closeModal('addVisitModal');
                
                // 방문 기록 새로고침
                const visits = await loadVisitData(currentComplex.id);
                renderVisitTimeline(visits);
                
                // 단지 목록도 새로고침
                await loadComplexes();
                
                // 캘린더도 새로고침
                await renderCalendarWithSchedules();
                
                alert('방문 기록이 저장되었습니다.');
            } catch (err) {
                console.error('방문 기록 저장 실패:', err);
                alert('저장에 실패했습니다.');
            }
        }

        // ===== 방문 기록 수정 모달 열기 =====
        function openEditVisitModal(id, date, purpose, defectType, memo, nextVisit) {
            document.getElementById('editVisitId').value = id;
            document.getElementById('editVisitDate').value = date;
            document.getElementById('editVisitPurpose').value = purpose;
            document.getElementById('editDefectType').value = defectType;
            document.getElementById('editVisitMemo').value = memo;
            document.getElementById('editNextVisitDate').value = nextVisit;
            openModal('editVisitModal');
        }

        // ===== 방문 기록 수정 저장 =====
        async function updateVisitRecord() {
            const id = document.getElementById('editVisitId').value;
            const visitDate = document.getElementById('editVisitDate').value;
            const purpose = document.getElementById('editVisitPurpose').value;
            const defectType = document.getElementById('editDefectType').value;
            const memo = document.getElementById('editVisitMemo').value;
            const nextVisit = document.getElementById('editNextVisitDate').value;

            try {
                const { error } = await supabaseClient
                    .from('visit_records')
                    .update({
                        visit_date: visitDate,
                        purpose: purpose,
                        defect_type: defectType || null,
                        memo: memo || null,
                        next_visit_date: nextVisit || null
                    })
                    .eq('id', id);

                if (error) throw error;

                closeModal('editVisitModal');
                const visits = await loadVisitData(currentComplex.id);
                renderVisitTimeline(visits);
                await loadComplexes();
                alert('방문 기록이 수정되었습니다.');
            } catch (err) {
                console.error('방문 기록 수정 실패:', err);
                alert('수정에 실패했습니다.');
            }
        }

        // ===== 방문 기록 삭제 확인 =====
        function confirmDeleteVisit(id) {
            if (confirm('이 방문 기록을 삭제하시겠습니까?')) {
                deleteVisitRecordById(id);
            }
        }

        // ===== 방문 기록 삭제 =====
        async function deleteVisitRecordById(id) {
            try {
                const { error } = await supabaseClient
                    .from('visit_records')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                const visits = await loadVisitData(currentComplex.id);
                renderVisitTimeline(visits);
                alert('방문 기록이 삭제되었습니다.');
            } catch (err) {
                console.error('방문 기록 삭제 실패:', err);
                alert('삭제에 실패했습니다.');
            }
        }

        // 수정 모달에서 삭제 버튼 클릭
        function deleteVisitRecord() {
            const id = document.getElementById('editVisitId').value;
            if (confirm('이 방문 기록을 삭제하시겠습니까?')) {
                closeModal('editVisitModal');
                deleteVisitRecordById(id);
            }
        }

        // ===== 일정 관련 변수 =====
        let scheduleData = [];
        let editingScheduleId = null;
        let usersCache = null;

        // ===== 사용자 목록 로드 =====
        async function loadUsers() {
            if (usersCache) return usersCache;
            
            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('id, name, email, role')
                    .order('name');
                
                if (error) throw error;
                usersCache = data;
                return data;
            } catch (err) {
                console.error('사용자 로드 실패:', err);
                return [];
            }
        }

        // ===== 일정 로드 (DB) =====
        async function loadSchedules() {
            try {
                let query = supabaseClient
                    .from('schedules')
                    .select(`
                        *,
                        user:users!schedules_user_id_fkey(id, name),
                        complex:complexes!schedules_complex_id_fkey(id, name)
                    `)
                    .eq('complex_id', currentComplex.id)
                    .order('schedule_date', { ascending: true });

                const { data, error } = await query;

                if (error) throw error;

                scheduleData = data;
                return data;
            } catch (err) {
                console.error('일정 로드 실패:', err);
                return [];
            }
        }

        // ===== 일정 추가 모달 열기 =====
        async function openAddScheduleModal(date, fromMain = false) {
            editingScheduleId = null;
            document.getElementById('scheduleModalTitle').textContent = '일정 추가';
            document.getElementById('scheduleId').value = '';
            document.getElementById('scheduleTitle').value = '';
            document.getElementById('scheduleDate').value = date || new Date().toISOString().split('T')[0];
            document.getElementById('scheduleType').value = '';
            document.getElementById('scheduleDesc').value = '';
            
            // 단지 선택 필드 설정
            const complexGroup = document.getElementById('scheduleComplexGroup');
            const complexSelect = document.getElementById('scheduleComplex');
            
            if (currentComplex && !fromMain) {
                // 단지 상세 페이지에서 호출 - 단지 선택 숨기고 자동 설정
                complexGroup.style.display = 'none';
                complexSelect.innerHTML = `<option value="${currentComplex.id}" selected>${currentComplex.name}</option>`;
            } else {
                // 메인 페이지에서 호출 - 단지 선택 표시
                complexGroup.style.display = 'block';
                complexSelect.innerHTML = '<option value="">단지를 선택하세요</option>' + 
                    complexData.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            }
            
            // 담당자 선택 필드 설정
            const assigneeGroup = document.getElementById('scheduleAssigneeGroup');
            const assigneeSelect = document.getElementById('scheduleAssignee');
            assigneeGroup.style.display = 'block';
            
            // 담당자 목록 로드
            const users = await loadUsers();
            assigneeSelect.innerHTML = '<option value="">담당자를 선택하세요</option>' + 
                users.map(u => `<option value="${u.id}" ${u.id === currentUser.id ? 'selected' : ''}>${u.name} (${u.role})</option>`).join('');
            
            // 푸터 버튼 조정
            document.getElementById('scheduleModalFooter').innerHTML = `
                <button class="btn btn-secondary" onclick="closeModal('scheduleModal')">취소</button>
                <button class="btn btn-primary" onclick="saveSchedule()">저장</button>
            `;
            
            openModal('scheduleModal');
        }

        // ===== 일정 수정 모달 열기 =====
        async function openEditScheduleModal(schedule) {
            editingScheduleId = schedule.id;
            document.getElementById('scheduleModalTitle').textContent = '일정 수정';
            document.getElementById('scheduleId').value = schedule.id;
            document.getElementById('scheduleTitle').value = schedule.title;
            document.getElementById('scheduleDate').value = schedule.schedule_date;
            document.getElementById('scheduleType').value = schedule.schedule_type;
            document.getElementById('scheduleDesc').value = schedule.description || '';
            
            // 단지 선택 필드 - 수정 시에는 숨김 (변경 불가)
            const complexGroup = document.getElementById('scheduleComplexGroup');
            const complexSelect = document.getElementById('scheduleComplex');
            complexGroup.style.display = 'none';
            complexSelect.innerHTML = `<option value="${schedule.complex_id}" selected>${schedule.complex?.name || ''}</option>`;
            
            // 담당자 선택 필드
            const assigneeGroup = document.getElementById('scheduleAssigneeGroup');
            const assigneeSelect = document.getElementById('scheduleAssignee');
            assigneeGroup.style.display = 'block';
            
            const users = await loadUsers();
            assigneeSelect.innerHTML = users.map(u => 
                `<option value="${u.id}" ${u.id === schedule.user_id ? 'selected' : ''}>${u.name} (${u.role})</option>`
            ).join('');
            
            // 푸터 버튼 조정 (삭제 버튼 추가)
            document.getElementById('scheduleModalFooter').innerHTML = `
                <button class="btn btn-danger" onclick="deleteSchedule('${schedule.id}')" style="margin-right: auto;">삭제</button>
                <button class="btn btn-secondary" onclick="closeModal('scheduleModal')">취소</button>
                <button class="btn btn-primary" onclick="saveSchedule()">수정 저장</button>
            `;
            
            openModal('scheduleModal');
        }

        // ===== 일정 저장 =====
        async function saveSchedule() {
            const id = document.getElementById('scheduleId').value;
            const complexId = document.getElementById('scheduleComplex').value;
            const assigneeId = document.getElementById('scheduleAssignee').value;
            const title = document.getElementById('scheduleTitle').value;
            const date = document.getElementById('scheduleDate').value;
            const type = document.getElementById('scheduleType').value;
            const desc = document.getElementById('scheduleDesc').value;

            if (!complexId || !assigneeId || !title || !date || !type) {
                alert('필수 항목을 입력해주세요.');
                return;
            }

            try {
                if (editingScheduleId) {
                    // 수정
                    const { error } = await supabaseClient
                        .from('schedules')
                        .update({
                            user_id: assigneeId,
                            title: title,
                            schedule_date: date,
                            schedule_type: type,
                            description: desc || null
                        })
                        .eq('id', editingScheduleId);

                    if (error) throw error;
                    alert('일정이 수정되었습니다.');
                } else {
                    // 추가
                    const { error } = await supabaseClient
                        .from('schedules')
                        .insert({
                            complex_id: complexId,
                            user_id: assigneeId,
                            title: title,
                            schedule_date: date,
                            schedule_type: type,
                            description: desc || null
                        });

                    if (error) throw error;
                    alert('일정이 추가되었습니다.');
                }

                closeModal('scheduleModal');
                
                // 메인 캘린더 새로고침
                await renderMainCalendar();
                
                // 단지 상세 페이지에 있으면 해당 캘린더도 새로고침
                if (currentComplex) {
                    await renderCalendarWithSchedules();
                }
            } catch (err) {
                console.error('일정 저장 실패:', err);
                alert('저장에 실패했습니다.');
            }
        }

        // ===== 일정 삭제 =====
        async function deleteSchedule(id) {
            if (!confirm('이 일정을 삭제하시겠습니까?')) return;

            try {
                const { error } = await supabaseClient
                    .from('schedules')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                closeModal('scheduleModal');
                
                // 메인 캘린더 새로고침
                await renderMainCalendar();
                
                // 단지 상세 페이지에 있으면 해당 캘린더도 새로고침
                if (currentComplex) {
                    await renderCalendarWithSchedules();
                }
                
                alert('일정이 삭제되었습니다.');
            } catch (err) {
                console.error('일정 삭제 실패:', err);
                alert('삭제에 실패했습니다.');
            }
        }

        // ===== 캘린더 + 일정 목록 렌더링 (단지 상세용) =====
        async function renderCalendarWithSchedules() {
            const schedules = await loadSchedules();
            const monthEl = document.getElementById('calendarMonth');
            const gridEl = document.getElementById('calendarGrid');
            renderCalendarNew(schedules, monthEl, gridEl, currentMonth);
            renderScheduleList(schedules, 'scheduleList', currentMonth);
        }

        // ===== 새로운 캘린더 렌더링 =====
        function renderCalendarNew(schedules, monthEl, gridEl, currentMonthDate, isMain = false) {
            const year = currentMonthDate.getFullYear();
            const month = currentMonthDate.getMonth();
            
            monthEl.textContent = `${year}년 ${month + 1}월`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            const today = new Date();
            
            // 일정을 날짜별로 그룹화
            const schedulesByDate = {};
            schedules.forEach(s => {
                if (!schedulesByDate[s.schedule_date]) {
                    schedulesByDate[s.schedule_date] = [];
                }
                schedulesByDate[s.schedule_date].push(s);
            });
            
            let html = days.map(d => `<div class="calendar-day-header">${d}</div>`).join('');
            
            // Previous month days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month"><span class="calendar-day-number">${prevMonthLastDay - i}</span></div>`;
            }
            
            // Current month days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const isToday = today.getDate() === i && today.getMonth() === month && today.getFullYear() === year;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const daySchedules = schedulesByDate[dateStr] || [];
                
                const onClickHandler = isMain ? `openAddScheduleModal('${dateStr}', true)` : `openAddScheduleModal('${dateStr}')`;
                
                let dayHtml = `<div class="calendar-day${isToday ? ' today' : ''}" data-date="${dateStr}" onclick="${onClickHandler}">`;
                dayHtml += `<span class="calendar-day-number">${i}</span>`;
                
                // 일정 텍스트 표시 (최대 3개)
                const displaySchedules = daySchedules.slice(0, 3);
                displaySchedules.forEach(s => {
                    const userName = s.user?.name || '';
                    const displayTitle = userName ? `${s.title} (${userName})` : s.title;
                    dayHtml += `<div class="calendar-event-item ${s.schedule_type}" onclick="event.stopPropagation(); openEditScheduleModal(${JSON.stringify(s).replace(/"/g, '&quot;')})">${displayTitle}</div>`;
                });
                
                // 더 있으면 +N 표시
                if (daySchedules.length > 3) {
                    dayHtml += `<div class="calendar-event-more">+${daySchedules.length - 3}개 더</div>`;
                }
                
                dayHtml += '</div>';
                html += dayHtml;
            }
            
            // Next month days
            const remainingDays = 42 - (startDay + lastDay.getDate());
            for (let i = 1; i <= remainingDays; i++) {
                html += `<div class="calendar-day other-month"><span class="calendar-day-number">${i}</span></div>`;
            }
            
            gridEl.innerHTML = html;
        }

        // ===== 일정 목록 렌더링 (D-Day 포함) =====
        function renderScheduleList(schedules, listElId, currentMonthDate) {
            const listEl = document.getElementById(listElId);
            if (!listEl) return;
            
            // 현재 월의 일정만 필터링
            const year = currentMonthDate.getFullYear();
            const month = currentMonthDate.getMonth();
            const monthSchedules = schedules.filter(s => {
                const d = new Date(s.schedule_date);
                return d.getFullYear() === year && d.getMonth() === month;
            }).sort((a, b) => new Date(a.schedule_date) - new Date(b.schedule_date));
            
            if (monthSchedules.length === 0) {
                listEl.innerHTML = '<div class="empty-schedule">이번 달 일정이 없습니다.</div>';
                return;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            listEl.innerHTML = monthSchedules.map(s => {
                const scheduleDate = new Date(s.schedule_date);
                scheduleDate.setHours(0, 0, 0, 0);
                const diffDays = Math.ceil((scheduleDate - today) / (1000 * 60 * 60 * 24));
                
                let ddayText = '';
                let ddayClass = '';
                
                if (diffDays === 0) {
                    ddayText = 'D-Day';
                    ddayClass = 'today';
                } else if (diffDays > 0) {
                    ddayText = `D-${diffDays}`;
                    ddayClass = 'upcoming';
                } else {
                    ddayText = `D+${Math.abs(diffDays)}`;
                    ddayClass = 'past';
                }
                
                // 단지 이름 및 담당자 표시
                const complexName = s.complex?.name || '';
                const userName = s.user?.name || '';
                const avatarName = getAvatarName(userName);
                
                return `
                    <div class="schedule-item" onclick="openEditScheduleModal(${JSON.stringify(s).replace(/"/g, '&quot;')})">
                        <div class="schedule-dday ${ddayClass}">${ddayText}</div>
                        <div class="schedule-info">
                            <div class="schedule-title">${s.title}</div>
                            <div class="schedule-desc">${complexName ? `📍 ${complexName}` : ''} ${s.description || ''}</div>
                        </div>
                        <div class="schedule-assignee">
                            <div class="schedule-assignee-avatar">${avatarName}</div>
                            <span class="schedule-assignee-name">${userName}</span>
                        </div>
                        <span class="schedule-type-badge ${s.schedule_type}">${getScheduleTypeLabel(s.schedule_type)}</span>
                    </div>
                `;
            }).join('');
        }

        // ===== 일정 유형 라벨 =====
        function getScheduleTypeLabel(type) {
            switch(type) {
                case 'visit': return '방문 예정';
                case 'deadline': return '마감';
                case 'reminder': return '리마인더';
                default: return '-';
            }
        }

        // ===== 메인 페이지 전체 일정 캘린더 =====
        let mainCalendarMonth = new Date();

        // 전체 일정 로드 (담당자 기준 모든 단지)
        async function loadAllSchedules(filterManagerId = null) {
            try {
                // 모든 계정에서 전체 일정 조회 가능
                let query = supabaseClient
                    .from('schedules')
                    .select(`
                        *,
                        user:users!schedules_user_id_fkey(id, name),
                        complex:complexes!schedules_complex_id_fkey(id, name)
                    `)
                    .order('schedule_date', { ascending: true });

                // 담당자 필터 적용
                if (filterManagerId) {
                    query = query.eq('user_id', filterManagerId);
                }

                const { data, error } = await query;

                if (error) throw error;
                return data;
            } catch (err) {
                console.error('전체 일정 로드 실패:', err);
                return [];
            }
        }

        // 메인 캘린더 렌더링
        async function renderMainCalendar() {
            const calendarManagerFilter = document.getElementById('calendarManagerFilter');
            const filterManagerId = calendarManagerFilter ? calendarManagerFilter.value : '';
            
            const schedules = await loadAllSchedules(filterManagerId);
            const monthEl = document.getElementById('mainCalendarMonth');
            const gridEl = document.getElementById('mainCalendarGrid');
            
            if (monthEl && gridEl) {
                renderCalendarNew(schedules, monthEl, gridEl, mainCalendarMonth, true);
                renderScheduleList(schedules, 'mainScheduleList', mainCalendarMonth);
            }
        }

        // 캘린더 담당자 필터 이벤트
        function setupCalendarManagerFilter() {
            const calendarManagerFilter = document.getElementById('calendarManagerFilter');
            if (calendarManagerFilter) {
                calendarManagerFilter.addEventListener('change', renderMainCalendar);
            }
        }

        // 메인 캘린더 월 변경
        async function changeMainMonth(delta) {
            mainCalendarMonth.setMonth(mainCalendarMonth.getMonth() + delta);
            await renderMainCalendar();
        }

        // ===== 초기화 =====
        document.addEventListener('DOMContentLoaded', function() {
            // 저장된 로그인 정보 확인
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            }
        });

        // Sample Data (DB 연동 - 사용 안함, 주석 처리)
        /*
        const complexData_backup = [
            {
                id: 1,
                name: "래미안 센트럴파크",
                region: "서울",
                address: "서울시 서초구 반포동 123-45",
                manager: "김철수",
                lastVisit: "2025-01-10",
                status: "정상",
                managerPhone: "010-1234-5678",
                caretaker: "홍길동",
                caretakerPhone: "02-1234-5678",
                memo: "2024년 방수공사 완료. 5년 보증 기간 중.",
                constructionTypes: ["슬라브-우레탄", "외벽 재도장 및 균열보수", "지하주차장 에폭시"]
            },
            {
                id: 2,
                name: "힐스테이트 광교",
                region: "경기",
                address: "경기도 수원시 영통구 이의동 456-78",
                manager: "박영희",
                lastVisit: "2025-01-08",
                status: "추적 필요",
                managerPhone: "010-2345-6789",
                caretaker: "김영수",
                caretakerPhone: "031-234-5678",
                memo: "외벽 균열 발견. 추가 점검 필요.",
                constructionTypes: ["외벽 재도장 및 균열보수", "아스콘"]
            },
            {
                id: 3,
                name: "푸르지오 해운대",
                region: "부산",
                address: "부산시 해운대구 우동 789-12",
                manager: "이민호",
                lastVisit: "2024-12-28",
                status: "재방문 필요",
                managerPhone: "010-3456-7890",
                caretaker: "박철민",
                caretakerPhone: "051-345-6789",
                memo: "지하주차장 누수 민원 접수. 긴급 대응 필요.",
                constructionTypes: ["지하주차장 방수", "지하주차장 에폭시"]
            },
            {
                id: 4,
                name: "e편한세상 판교",
                region: "경기",
                address: "경기도 성남시 분당구 판교동 111-22",
                manager: "김철수",
                lastVisit: "2025-01-12",
                status: "정상",
                managerPhone: "010-1234-5678",
                caretaker: "정우성",
                caretakerPhone: "031-456-7890",
                memo: "정기 점검 완료. 특이사항 없음.",
                constructionTypes: ["아스팔트슁글 방수", "보도블럭"]
            },
            {
                id: 5,
                name: "롯데캐슬 천안",
                region: "대전",
                address: "충남 천안시 서북구 불당동 333-44",
                manager: "박영희",
                lastVisit: "2025-01-05",
                status: "추적 필요",
                managerPhone: "010-2345-6789",
                caretaker: "이순신",
                caretakerPhone: "041-567-8901",
                memo: "옥상 방수층 점검 예정.",
                constructionTypes: ["슬라브-듀얼", "금속기와 방수"]
            },
            {
                id: 6,
                name: "아이파크 인천",
                region: "인천",
                address: "인천시 연수구 송도동 555-66",
                manager: "이민호",
                lastVisit: "2025-01-09",
                status: "정상",
                managerPhone: "010-3456-7890",
                caretaker: "강감찬",
                caretakerPhone: "032-678-9012",
                memo: "외벽 도장 보수 완료.",
                constructionTypes: ["외벽 재도장 및 균열보수", "슬라브-PVC", "아스콘", "보도블럭"]
            }
        ];

        const visitData_backup = [
            {
                date: "2025-01-10",
                visitor: "김철수",
                purpose: "정기점검",
                defectType: "방수",
                memo: "지하주차장 방수층 상태 양호. 일부 균열 부위 실링 처리 완료. 다음 분기 재점검 권장.",
                photos: [
                    { url: "https://via.placeholder.com/150/215a65/ffffff?text=1", type: "균열" },
                    { url: "https://via.placeholder.com/150/2d7a87/ffffff?text=2", type: "실링" }
                ],
                aiDiagnosis: {
                    defectType: "미세 균열",
                    defectLevel: "경미",
                    solution: "실링 처리 권장",
                    confidence: "92%"
                },
                nextVisit: "2025-04-10"
            },
            {
                date: "2024-10-15",
                visitor: "박영희",
                purpose: "하자점검",
                defectType: "도장",
                memo: "외벽 도장 박리 현상 확인. 남측 3~5층 집중 발생. 도장 보수 공사 일정 협의 필요.",
                photos: [
                    { url: "https://via.placeholder.com/150/ff9500/ffffff?text=3", type: "박리" }
                ],
                aiDiagnosis: {
                    defectType: "도장 박리",
                    defectLevel: "중간",
                    solution: "전면 재도장 권장",
                    confidence: "88%"
                },
                nextVisit: "2024-11-20"
            },
            {
                date: "2024-07-22",
                visitor: "김철수",
                purpose: "민원처리",
                defectType: "누수",
                memo: "101동 1502호 천장 누수 민원. 상층 욕실 배관 불량으로 확인. 배관 교체 완료.",
                photos: [
                    { url: "https://via.placeholder.com/150/ff3b30/ffffff?text=4", type: "누수" },
                    { url: "https://via.placeholder.com/150/00c471/ffffff?text=5", type: "수리" }
                ],
                aiDiagnosis: null,
                nextVisit: "2024-08-22"
            }
        ];
        */

        // Notification Data
        // 알림 데이터 (실제 일정 기반으로 로드)
        let notificationData = [];

        // 알림 데이터 로드 (일정 기반)
        async function loadNotifications() {
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // 모든 계정에서 전체 일정 알림 조회 가능
                let query = supabaseClient
                    .from('schedules')
                    .select(`
                        *,
                        user:users!schedules_user_id_fkey(id, name),
                        complex:complexes!schedules_complex_id_fkey(id, name)
                    `)
                    .order('schedule_date', { ascending: true });

                const { data, error } = await query;
                if (error) throw error;

                notificationData = data.map(s => {
                    const scheduleDate = new Date(s.schedule_date);
                    scheduleDate.setHours(0, 0, 0, 0);
                    const diffDays = Math.ceil((scheduleDate - today) / (1000 * 60 * 60 * 24));
                    
                    let type, icon, desc;
                    
                    if (diffDays < 0) {
                        // 지난 일정
                        type = 'overdue';
                        icon = 'danger';
                        desc = `예정된 일정이 ${Math.abs(diffDays)}일 지났습니다.`;
                    } else if (diffDays === 0) {
                        // 오늘
                        type = 'upcoming';
                        icon = 'warning';
                        desc = '오늘 예정된 일정입니다!';
                    } else if (diffDays <= 7) {
                        // 7일 이내
                        type = 'upcoming';
                        icon = diffDays <= 3 ? 'warning' : 'info';
                        desc = `${diffDays}일 후 예정된 일정입니다.`;
                    } else {
                        // 7일 이후는 알림에서 제외
                        return null;
                    }

                    return {
                        id: s.id,
                        type: type,
                        icon: icon,
                        title: s.title,
                        manager: s.user?.name || '-',
                        desc: desc,
                        time: formatRelativeTime(s.created_at),
                        daysLeft: diffDays > 0 ? diffDays : 0,
                        daysOverdue: diffDays < 0 ? Math.abs(diffDays) : 0,
                        complexId: s.complex_id,
                        complexName: s.complex?.name || '-',
                        date: s.schedule_date,
                        unread: diffDays >= 0 && diffDays <= 3
                    };
                }).filter(n => n !== null);

                renderNotifications('upcoming');
                updateNotificationBadge();
            } catch (err) {
                console.error('알림 로드 실패:', err);
            }
        }

        // 상대적 시간 포맷
        function formatRelativeTime(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return '방금 전';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}분 전`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}시간 전`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)}일 전`;
            
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        // Calendar Events Data (더 이상 사용 안함 - 일정 DB로 대체)
        const calendarEvents = {
            '2025-01-10': [
                { type: 'visit', title: '정기점검 완료', sub: '김철수 방문' }
            ],
            '2025-01-15': [
                { type: 'deadline', title: '하자점검 예정', sub: 'e편한세상 판교' }
            ],
            '2025-01-17': [
                { type: 'visit', title: '정기점검 예정', sub: '래미안 센트럴파크' }
            ],
            '2025-01-22': [
                { type: 'visit', title: '민원처리 예정', sub: '101동 누수 확인' },
                { type: 'deadline', title: '보고서 제출 마감', sub: '월간 리포트' }
            ]
        };

        // Initialize
        // 기존 Initialize (로그인 시스템으로 대체됨)
        /*
        document.addEventListener('DOMContentLoaded', function() {
            renderComplexGrid(complexData);
            setupSearch();
            renderNotifications('upcoming');
            updateNotificationBadge();
            updateStats();
        });
        */

        // Update stats based on actual data
        function updateStats(filteredData = null) {
            const data = filteredData || complexData;
            const total = data.length;
            const normal = data.filter(c => c.status === '정상').length;
            const tracking = data.filter(c => c.status === '추적 필요').length;
            const revisit = data.filter(c => c.status === '재방문 필요').length;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statNormal').textContent = normal;
            document.getElementById('statNormalPercent').textContent = total > 0 ? Math.round(normal / total * 100) + '%' : '0%';
            document.getElementById('statTracking').textContent = tracking;
            document.getElementById('statRevisit').textContent = revisit;
            
            // Hide urgent label if no revisit needed
            const revisitLabel = document.getElementById('statRevisitLabel');
            if (revisitLabel) {
                revisitLabel.style.display = revisit === 0 ? 'none' : 'block';
            }
        }

        // Render Complex Grid
        function renderComplexGrid(data) {
            const grid = document.getElementById('complexGrid');
            grid.innerHTML = data.map(complex => `
                <div class="complex-card" onclick="showDetail('${complex.id}')">
                    <div class="complex-header">
                        <div>
                            <div class="complex-name">${complex.name}</div>
                            <div class="complex-address">${complex.address}</div>
                        </div>
                        <span class="status-badge status-${getStatusClass(complex.status)}">${complex.status}</span>
                    </div>
                    <div class="complex-info">
                        <div class="info-item">
                            <span class="info-label">담당자</span>
                            <span class="info-value">${complex.manager}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">지역</span>
                            <span class="info-value">${complex.region}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">최근 방문일</span>
                            <span class="info-value">${formatDate(complex.lastVisit)}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">관리소장</span>
                            <span class="info-value">${complex.caretaker}</span>
                        </div>
                    </div>
                    ${complex.constructionTypes && complex.constructionTypes.length > 0 ? `
                        <div class="construction-types">
                            ${complex.constructionTypes.map(type => `<span class="construction-tag">${type}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Get status class
        function getStatusClass(status) {
            switch(status) {
                case '정상': return 'normal';
                case '추적 필요': return 'tracking';
                case '재방문 필요': return 'revisit';
                default: return 'normal';
            }
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
        }

        // Setup search and filters
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const regionFilter = document.getElementById('regionFilter');
            const statusFilter = document.getElementById('statusFilter');
            const managerFilter = document.getElementById('managerFilter');

            searchInput.addEventListener('input', applyFilters);
            regionFilter.addEventListener('change', applyFilters);
            statusFilter.addEventListener('change', applyFilters);
            if (managerFilter) {
                managerFilter.addEventListener('change', applyFilters);
            }
        }

        // Show detail page
        async function showDetail(id) {
            currentComplex = complexData.find(c => c.id === id);
            if (!currentComplex) return;

            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('detailPage').classList.add('active');

            renderDetailHeader();
            
            // DB에서 방문 기록 로드
            const visits = await loadVisitData(currentComplex.id);
            renderVisitTimeline(visits);
            
            // 캘린더 + 일정 로드
            await renderCalendarWithSchedules();
            
            renderManagerList();
        }

        // Show main page (단지 관리)
        function showMainPage() {
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('calendarPage').classList.add('hidden');
            document.getElementById('usersPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('detailPage').classList.remove('active');
            currentComplex = null;
            
            // 네비게이션 활성화
            document.getElementById('navComplexList').classList.add('active');
            document.getElementById('navCalendar').classList.remove('active');
            const navUsers = document.getElementById('navUsers');
            if (navUsers) navUsers.classList.remove('active');
            const navDashboard = document.getElementById('navDashboard');
            if (navDashboard) navDashboard.classList.remove('active');
        }

        // Show calendar page (일정 캘린더)
        async function showCalendarPage() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('calendarPage').classList.remove('hidden');
            document.getElementById('usersPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('detailPage').classList.remove('active');
            currentComplex = null;
            
            // 네비게이션 활성화
            document.getElementById('navComplexList').classList.remove('active');
            document.getElementById('navCalendar').classList.add('active');
            const navUsers = document.getElementById('navUsers');
            if (navUsers) navUsers.classList.remove('active');
            const navDashboard = document.getElementById('navDashboard');
            if (navDashboard) navDashboard.classList.remove('active');
            
            // 담당자 필터 이벤트 설정
            setupCalendarManagerFilter();
            
            // 캘린더 렌더링
            await renderMainCalendar();
        }

        // 오늘로 이동
        function goToToday() {
            mainCalendarMonth = new Date();
            renderMainCalendar();
        }

        // Render detail header
        function renderDetailHeader() {
            const header = document.getElementById('detailHeader');
            header.innerHTML = `
                <div class="detail-title-row">
                    <div>
                        <h1 class="detail-title">${currentComplex.name}</h1>
                        <p class="detail-address">${currentComplex.address}</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <select class="status-select" onchange="changeComplexStatus(this.value)">
                            <option value="정상" ${currentComplex.status === '정상' ? 'selected' : ''}>정상</option>
                            <option value="추적 필요" ${currentComplex.status === '추적 필요' ? 'selected' : ''}>추적 필요</option>
                            <option value="재방문 필요" ${currentComplex.status === '재방문 필요' ? 'selected' : ''}>재방문 필요</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" onclick="openEditComplexModal()">정보 수정</button>
                    </div>
                </div>
                ${currentComplex.constructionTypes && currentComplex.constructionTypes.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                        <span class="meta-label">시공 공사</span>
                        <div class="detail-construction-types">
                            ${currentComplex.constructionTypes.map(type => `<span class="detail-construction-tag">${type}</span>`).join('')}
                        </div>
                    </div>
                ` : ''}
                <div class="detail-meta">
                    <div class="meta-item">
                        <span class="meta-label">담당자</span>
                        <span class="meta-value">${currentComplex.manager}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">담당자 연락처</span>
                        <span class="meta-value">${currentComplex.managerPhone}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">관리소장</span>
                        <span class="meta-value">${currentComplex.caretaker}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">관리소 연락처</span>
                        <span class="meta-value">${currentComplex.caretakerPhone}</span>
                    </div>
                    <div class="meta-item" style="grid-column: span 2;">
                        <span class="meta-label">특이사항</span>
                        <span class="meta-value editable">${currentComplex.memo || '메모 없음'}</span>
                    </div>
                </div>
            `;
        }

        // Render visit timeline
        function renderVisitTimeline(visits) {
            const timeline = document.getElementById('visitTimeline');
            
            if (!visits || visits.length === 0) {
                timeline.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">방문 기록이 없습니다.</div>';
                return;
            }
            
            timeline.innerHTML = visits.map(visit => `
                <div class="visit-card">
                    <div class="visit-header">
                        <span class="visit-date">${formatDate(visit.date)}</span>
                        <span class="visit-purpose">${visit.purpose}</span>
                    </div>
                    <div class="visit-body">
                        <div class="visit-row">
                            <div class="visit-field">
                                <div class="visit-label">방문자</div>
                                <div class="visit-value">${visit.visitor}</div>
                            </div>
                            <div class="visit-field">
                                <div class="visit-label">하자 구분</div>
                                <div class="visit-value">${visit.defectType || '-'}</div>
                            </div>
                        </div>
                        <div class="visit-memo">${visit.memo || '메모 없음'}</div>
                    </div>
                    ${visit.photos && visit.photos.length > 0 ? `
                        <div class="visit-photos">
                            <div class="visit-label">현장 사진 (${visit.photos.length}장)</div>
                            <div class="visit-photos-grid">
                                ${visit.photos.map(photo => `
                                    <div class="visit-photo-thumb" onclick="openPhotoModal('${photo.data || photo.url}')">
                                        <img src="${photo.data || photo.url}" alt="현장 사진">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    ${visit.aiDiagnosis ? `
                        <div class="ai-diagnosis">
                            <div class="ai-header">
                                <div class="ai-icon">AI</div>
                                <span class="ai-title">AI 하자 진단 결과</span>
                            </div>
                            <div class="ai-result">
                                <div class="ai-item">
                                    <div class="ai-item-label">하자 유형</div>
                                    <div class="ai-item-value">${visit.aiDiagnosis.defectType}</div>
                                </div>
                                <div class="ai-item">
                                    <div class="ai-item-label">심각도</div>
                                    <div class="ai-item-value">${visit.aiDiagnosis.defectLevel}</div>
                                </div>
                                <div class="ai-item">
                                    <div class="ai-item-label">권장 솔루션</div>
                                    <div class="ai-item-value">${visit.aiDiagnosis.solution}</div>
                                </div>
                                <div class="ai-item">
                                    <div class="ai-item-label">신뢰도</div>
                                    <div class="ai-item-value">${visit.aiDiagnosis.confidence}</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    ${visit.nextVisit ? `
                        <div class="next-visit">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <div>
                                <div class="next-visit-label">다음 방문 예정</div>
                                <div class="next-visit-date">${formatDate(visit.nextVisit)}</div>
                            </div>
                        </div>
                    ` : ''}
                    <div class="visit-actions">
                        <button class="visit-action-btn" onclick="openEditVisitModal('${visit.id}', '${visit.date}', '${visit.purpose}', '${visit.defectType || ''}', '${(visit.memo || '').replace(/'/g, "\\'")}', '${visit.nextVisit || ''}')">수정</button>
                        <button class="visit-action-btn delete" onclick="confirmDeleteVisit('${visit.id}')">삭제</button>
                        <button class="visit-action-btn" onclick="toggleComments('${visit.id}')">💬 댓글</button>
                    </div>
                    <div class="visit-comments" id="comments-${visit.id}" style="display: none;">
                        <div class="comments-list" id="comments-list-${visit.id}">
                            <!-- 댓글 로드 -->
                        </div>
                        <div class="comment-input-box">
                            <input type="text" class="comment-input" id="comment-input-${visit.id}" placeholder="댓글을 입력하세요..." onkeypress="if(event.key==='Enter') addComment('${visit.id}')">
                            <button class="comment-submit-btn" onclick="addComment('${visit.id}')">등록</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // 댓글이 있는 방문 기록은 자동으로 펼치기
            visits.forEach(visit => {
                loadAndShowCommentsIfExist(visit.id);
            });
        }

        // 댓글이 있으면 자동으로 로드하고 펼치기
        async function loadAndShowCommentsIfExist(visitId) {
            try {
                const { data, error, count } = await supabaseClient
                    .from('comments')
                    .select('*', { count: 'exact', head: true })
                    .eq('visit_record_id', visitId);

                if (!error && count > 0) {
                    // 댓글이 있으면 로드하고 펼치기
                    await loadComments(visitId);
                    const commentsEl = document.getElementById(`comments-${visitId}`);
                    if (commentsEl) {
                        commentsEl.style.display = 'block';
                    }
                }
            } catch (err) {
                console.error('댓글 확인 실패:', err);
            }
        }

        // Render calendar
        function renderCalendar() {
            const monthEl = document.getElementById('calendarMonth');
            const gridEl = document.getElementById('calendarGrid');
            
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            monthEl.textContent = `${year}년 ${month + 1}월`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            const today = new Date();
            
            let html = days.map(d => `<div class="calendar-day-header">${d}</div>`).join('');
            
            // Previous month days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month">${prevMonthLastDay - i}</div>`;
            }
            
            // Current month days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const isToday = today.getDate() === i && today.getMonth() === month && today.getFullYear() === year;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const events = calendarEvents[dateStr];
                const hasEvent = events && events.length > 0;
                
                let dayHtml = `<div class="calendar-day${isToday ? ' today' : ''}${hasEvent ? ' has-event' : ''}" data-date="${dateStr}">${i}`;
                
                if (hasEvent) {
                    dayHtml += `
                        <div class="calendar-event-popup">
                            <div class="event-popup-date">${month + 1}월 ${i}일 일정</div>
                            ${events.map(event => `
                                <div class="event-popup-item">
                                    <div class="event-dot ${event.type}"></div>
                                    <div class="event-popup-content">
                                        <div class="event-popup-title">${event.title}</div>
                                        <div class="event-popup-sub">${event.sub}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                dayHtml += '</div>';
                html += dayHtml;
            }
            
            // Next month days
            const remainingDays = 42 - (startDay + lastDay.getDate());
            for (let i = 1; i <= remainingDays; i++) {
                html += `<div class="calendar-day other-month">${i}</div>`;
            }
            
            gridEl.innerHTML = html;
        }

        // Change month
        async function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            await renderCalendarWithSchedules();
        }

        // Render manager list
        function renderManagerList() {
            const list = document.getElementById('managerList');
            list.innerHTML = `
                <div class="manager-card">
                    <div class="manager-avatar">${currentComplex.manager[0]}</div>
                    <div class="manager-info">
                        <div class="manager-name">${currentComplex.manager}</div>
                        <div class="manager-role">사후관리 담당자</div>
                        <div class="manager-contact">${currentComplex.managerPhone}</div>
                    </div>
                    <button class="manager-action">변경</button>
                </div>
                <div class="manager-card">
                    <div class="manager-avatar" style="background: linear-gradient(135deg, #00c471, #00a65a);">${currentComplex.caretaker[0]}</div>
                    <div class="manager-info">
                        <div class="manager-name">${currentComplex.caretaker}</div>
                        <div class="manager-role">관리소장</div>
                        <div class="manager-contact">${currentComplex.caretakerPhone}</div>
                    </div>
                    <button class="manager-action">수정</button>
                </div>
            `;
        }

        // Switch tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Reset checklist visibility when closing visit modal
            if (modalId === 'addVisitModal') {
                resetVisitModal();
            }
        }

        // Reset visit modal
        function resetVisitModal() {
            const scopes = ['exterior', 'parking', 'roof', 'rooftop', 'ascon', 'block'];
            scopes.forEach(scope => {
                document.getElementById('scope_' + scope).checked = false;
                document.getElementById('checklist_' + scope).classList.remove('active');
            });
        }

        // Toggle checklist visibility
        function toggleChecklist(scope) {
            const checkbox = document.getElementById('scope_' + scope);
            const checklist = document.getElementById('checklist_' + scope);
            
            if (checkbox.checked) {
                checklist.classList.add('active');
            } else {
                checklist.classList.remove('active');
            }
        }

        // Toggle sidebar (mobile)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Close sidebar when clicking outside
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');
            if (window.innerWidth <= 1024 && !sidebar.contains(e.target) && !toggle.contains(e.target)) {
                sidebar.classList.remove('open');
            }
        });

        // Close modals on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });

        // Close modal when clicking outside
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Toggle Notification Panel
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            const overlay = document.getElementById('notificationOverlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        // Render Notifications
        function renderNotifications(filter = 'upcoming') {
            const list = document.getElementById('notificationList');
            let filteredData = notificationData;
            
            if (filter === 'upcoming') {
                filteredData = notificationData.filter(n => n.type === 'upcoming');
            } else if (filter === 'overdue') {
                filteredData = notificationData.filter(n => n.type === 'overdue');
            }
            
            if (filteredData.length === 0) {
                list.innerHTML = `
                    <div class="notification-empty">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                        </svg>
                        <p>알림이 없습니다</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredData.map(notif => `
                <div class="notification-item ${notif.unread ? 'unread' : ''}">
                    <div class="notification-icon ${notif.icon}">
                        ${getNotificationIcon(notif.icon)}
                    </div>
                    <div class="notification-content">
                        <div class="notification-item-title">${notif.title}</div>
                        <div class="notification-item-desc">📍 ${notif.complexName} · ${notif.desc}</div>
                        <div class="notification-item-time">@${notif.manager} · ${notif.date}</div>
                        <div class="notification-item-action">
                            <button class="notif-btn notif-btn-primary" onclick="goToComplex('${notif.complexId}')">단지 보기</button>
                            <button class="notif-btn notif-btn-secondary" onclick="dismissNotification('${notif.id}')">확인</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Get notification icon SVG
        function getNotificationIcon(type) {
            switch(type) {
                case 'warning':
                    return '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>';
                case 'danger':
                    return '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                case 'info':
                    return '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>';
                case 'success':
                    return '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                default:
                    return '';
            }
        }

        // Switch notification tab
        function switchNotificationTab(tabName, element) {
            document.querySelectorAll('.notification-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            renderNotifications(tabName);
        }

        // Update notification badge
        function updateNotificationBadge() {
            const unreadCount = notificationData.filter(n => n.unread).length;
            const badge = document.getElementById('notificationBadge');
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            
            // Update tab counts
            document.getElementById('upcomingCount').textContent = notificationData.filter(n => n.type === 'upcoming').length;
            document.getElementById('overdueCount').textContent = notificationData.filter(n => n.type === 'overdue').length;
        }

        // Go to complex from notification
        function goToComplex(complexId) {
            toggleNotificationPanel();
            showDetail(complexId);
        }

        // Dismiss notification
        function dismissNotification(notifId) {
            const index = notificationData.findIndex(n => n.id === notifId);
            if (index !== -1) {
                notificationData[index].unread = false;
                const activeTab = document.querySelector('.notification-tab.active');
                const filter = activeTab ? (activeTab.textContent.includes('예정') ? 'upcoming' : 'overdue') : 'upcoming';
                renderNotifications(filter);
                updateNotificationBadge();
            }
        }
    </script>
</body>
</html>
